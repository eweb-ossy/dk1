!function(){function l(t,e){if((e=(e=(e=(e=(e=(e=e.replace(/YYYY/g,t.getFullYear())).replace(/MM/g,("0"+(t.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+t.getDate()).slice(-2))).replace(/hh/g,("0"+t.getHours()).slice(-2))).replace(/mm/g,("0"+t.getMinutes()).slice(-2))).replace(/ss/g,("0"+t.getSeconds()).slice(-2))).match(/S/g))for(var a=("00"+t.getMilliseconds()).slice(-3),o=e.match(/S/g).length,n=0;n<o;n++)e=e.replace(/S/,a.substring(n,n+1));return e}var n,r,a,u,o,i={};function c(t){return Math.floor(t/60)+":"+("0"+t%60).slice(-2)}const d={getTableColumns:function(){return $.ajax({url:"../data/columns/list_user",dataType:"json",type:"POST"})},downloadData:function(t){var t="../../data/admin_download/"+t,e=document.createElement("form"),t=(e.setAttribute("action",t),e.setAttribute("method","post"),e.style.display="none",document.body.appendChild(e),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","column"),t.setAttribute("value",JSON.stringify(a)),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","dl_data"),t.setAttribute("value",JSON.stringify(u)),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","type"),t.setAttribute("value","list_user"),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","data_date"),t.setAttribute("value",l(new Date(o),"YYYY年MM月")),e.appendChild(t),document.createElement("input"));t.setAttribute("type","hidden"),t.setAttribute("name","all_data"),t.setAttribute("value",JSON.stringify(i)),e.appendChild(t),e.submit()},listData:function(t){var e=t.filter(t=>0<t.work_count),e=(i.work_count=e.reduce((t,e)=>t+Number(e.work_count),0),t.filter(t=>0<t.work_hour2)),e=(i.work_minute=e.reduce((t,e)=>t+Number(e.work_hour2),0),i.work_hour=0<i.work_minute?c(i.work_minute):"",t.filter(t=>0<t.normal_hour2)),e=(i.normal_minute=e.reduce((t,e)=>t+Number(e.normal_hour2),0),i.normal_hour=0<i.normal_minute?c(i.normal_minute):"",t.filter(t=>0<t.over_count)),e=(i.over_count=e.reduce((t,e)=>t+Number(e.over_count),0),t.filter(t=>0<t.over_hour2)),e=(i.over_minute=e.reduce((t,e)=>t+Number(e.over_hour2),0),i.over_hour=0<i.over_minute?c(i.over_minute):"",t.filter(t=>0<t.night_count)),e=(i.night_count=e.reduce((t,e)=>t+Number(e.night_count),0),t.filter(t=>0<t.night_hour2)),e=(i.night_minute=e.reduce((t,e)=>t+Number(e.night_hour2),0),i.night_hour=0<i.night_minute?c(i.night_minute):"",t.filter(t=>0<t.late_count)),e=(i.late_count=e.reduce((t,e)=>t+Number(e.late_count),0),t.filter(t=>0<t.late_hour2)),e=(i.late_minute=e.reduce((t,e)=>t+Number(e.late_hour2),0),i.late_hour=0<i.late_minute?c(i.late_minute):"",t.filter(t=>0<t.left_count)),e=(i.left_count=e.reduce((t,e)=>t+Number(e.left_count),0),t.filter(t=>0<t.left_hour2)),e=(i.left_minute=e.reduce((t,e)=>t+Number(e.left_hour2),0),i.left_hour=0<i.left_minute?c(i.left_minute):"",t.filter(t=>0<t.paid_num)),e=(i.paid_num=e.reduce((t,e)=>t+Number(e.paid_num),0),t.filter(t=>0<t.absence_num)),e=(i.absence_num=e.reduce((t,e)=>t+Number(e.absence_num),0),t.filter(t=>0<t.oneside_num)),e=(i.oneside_num=e.reduce((t,e)=>t+Number(e.oneside_num),0),t.filter(t=>0<t.zero_num));i.zero_num=e.reduce((t,e)=>t+Number(e.zero_num),0)}},_={renderDate:function(){(o=(r=flatpickr("#month",{plugins:[new monthSelectPlugin({dateFormat:"Y年m月",theme:"light"})],defaultDate:"today",onChange:function(){o=r.selectedDates[0],n.clearData(),_.renderTableData(),_.renderDateText(o)}})).selectedDates[0]).setDate(1),Cookies.get("listUser")&&(o=new Date(Cookies.get("listUser")),_.renderDateText(o))},renderDateText:function(t){r.setDate(t),o=0<end_day?((o=new Date(t)).setMonth(o.getMonth()-1),e=end_day+1,e=l(o,"YYYY年MM月")+e+"日",a=l(t,"YYYY年MM月")+end_day+"日",new Date(o.getFullYear(),o.getMonth()+1,0).getDate()-end_day+end_day):(e=l(new Date(t),"YYYY年MM月")+"01日",a=l(new Date(t.getFullYear(),t.getMonth()+1,0),"YYYY年MM月DD日"),new Date(t.getFullYear(),t.getMonth()+1,0).getDate()),$("#to_from_date").text(e+"から"+a+"までの"+o+"日間");var e=new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{era:"long",year:"numeric"}).format(new Date(t)),a=($("#date-area-wareki").text(e),new Date),o=a.getFullYear(),e=a.getMonth(),a=new Date(t),n=a.getFullYear(),a=a.getMonth(),o=new Date(o,e),e=new Date(n,a),n=o.getMonth()-e.getMonth()+12*(o.getFullYear()-e.getFullYear());0==n?($("#this_month").addClass("disable"),$("#this_month_mark").addClass("this-month"),$("#this_month_mark").text("今月")):($("#this_month").removeClass("disable"),$("#this_month_mark").removeClass("this-month"),0<n?$("#this_month_mark").text(n+"ヶ月前"):$("#this_month_mark").text(Math.abs(n)+"ヶ月後")),Cookies.set("listUser",t)},renderTableColumns:function(){d.getTableColumns().done(function(t){(a=t.filter(function(t){return t.output})).forEach(function(t,e){var a=0===e?"合計":"";t.field?i[t.field]=a:t.columns.forEach(function(t){i[t.field]=a})}),n=new Tabulator("#data_table",{height:"calc(100vh - 262px)",layout:"fitDataStretch",columns:t,tooltips:function(t){var e=t.getColumn();"work_count"!=e._column.field&&"work_hour"!=e._column.field&&"work_minute"!=e._column.field||(t.getElement().style.color="#1591a2"),"over_count"!=e._column.field&&"over_hour"!=e._column.field&&"over_minute"!=e._column.field&&"night_count"!=e._column.field&&"night_hour"!=e._column.field&&"night_minute"!=e._column.field&&"late_count"!=e._column.field&&"late_hour"!=e._column.field&&"late_minute"!=e._column.field&&"left_count"!=e._column.field&&"left_hour"!=e._column.field&&"left_minute"!=e._column.field&&"absence_num"!=e._column.field&&"oneside_num"!=e._column.field&&"zero_num"!=e._column.field||(t.getElement().style.color="#ff4560"),"normal_hour"!=e._column.field&&"normal_minute"!=e._column.field||(t.getElement().style.color="#673AB7"),"paid_num"==e._column.field&&(t.getElement().style.color="#40a598")},dataFiltered:function(t,e){var a=[];if(0<e.length){for(var o=0;o<e.length;o++)a.push(e[o]._row.data);d.listData(a),u=a,_.renderListData(),Cookies.set("listUserFilters",n.getHeaderFilters())}},dataSorted:function(t,e){var a=[];if(0<e.length){for(var o=0;o<e.length;o++)a.push(e[o]._row.data);d.listData(a),u=a,_.renderListData()}},rowClick:function(t,e){e=e.getData();e.user_id&&(Cookies.set("toListsMonth",o),Cookies.set("toListsuserID",parseInt(e.user_id)),Cookies.set("listUserFilters",n.getHeaderFilters()),window.location.href="admin_lists")},invalidOptionWarnings:!1,dataLoaded:function(t){0<t.length&&Cookies.get("listUserFilters")&&JSON.parse(Cookies.get("listUserFilters")).forEach(function(t){n.setHeaderFilterValue(t.field,t.value)})}}),_.renderTableData()})},renderTableData:function(){n.replaceData("../data/admin_list_user/table_data",{year:l(new Date(o),"YYYY"),month:l(new Date(o),"MM"),end_day:end_day},"POST"),n.hideColumn("work_hour2"),n.hideColumn("over_hour2"),n.hideColumn("night_hour2"),n.hideColumn("late_hour2"),n.hideColumn("left_hour2"),n.hideColumn("normal_hour2")},renderListData:function(){setTimeout(function(){$('.tabulator-calcs-top > [tabulator-field="work_hour"]').text(i.work_hour),$('.tabulator-calcs-top > [tabulator-field="work_minute"]').text(i.work_minute),$('.tabulator-calcs-top > [tabulator-field="rest_hour"]').text(i.rest_hour),$('.tabulator-calcs-top > [tabulator-field="rest_minute"]').text(i.rest_minute),$('.tabulator-calcs-top > [tabulator-field="over_hour"]').text(i.over_hour),$('.tabulator-calcs-top > [tabulator-field="over_minute"]').text(i.over_minute),$('.tabulator-calcs-top > [tabulator-field="night_hour"]').text(i.night_hour),$('.tabulator-calcs-top > [tabulator-field="night_minute"]').text(i.night_minute),$('.tabulator-calcs-top > [tabulator-field="late_hour"]').text(i.late_hour),$('.tabulator-calcs-top > [tabulator-field="late_minute"]').text(i.late_minute),$('.tabulator-calcs-top > [tabulator-field="left_hour"]').text(i.left_hour),$('.tabulator-calcs-top > [tabulator-field="left_minute"]').text(i.left_minute),$('.tabulator-calcs-top > [tabulator-field="normal_hour"]').text(i.normal_hour),$('.tabulator-calcs-top > [tabulator-field="normal_minute"]').text(i.normal_minute),$('.tabulator-calcs-top > [tabulator-field="work_count"]').text(i.work_count),$('.tabulator-calcs-top > [tabulator-field="over_count"]').text(i.over_count),$('.tabulator-calcs-top > [tabulator-field="night_count"]').text(i.night_count),$('.tabulator-calcs-top > [tabulator-field="late_count"]').text(i.late_count),$('.tabulator-calcs-top > [tabulator-field="left_count"]').text(i.left_count),$('.tabulator-calcs-top > [tabulator-field="paid_num"]').text(i.paid_num),$('.tabulator-calcs-top > [tabulator-field="absence_num"]').text(i.absence_num),$('.tabulator-calcs-top > [tabulator-field="oneside_num"]').text(i.oneside_num),$('.tabulator-calcs-top > [tabulator-field="zero_num"]').text(i.zero_num)},100)}};$(function(){function t(t){o=t?new Date(o.setMonth(o.getMonth()+t)):new Date,n.clearData(),_.renderTableData(),_.renderDateText(o)}_.renderDate(),_.renderDateText(o),_.renderTableColumns(),$("#less_month").on("click",function(){t(-1)}),$("#add_month").on("click",function(){t(1)}),$("#this_month_mark, #this_month").on("click",function(){t()}),$("#download_btn_excel").on("click",function(){d.downloadData("xlsx")}),$("#download_btn_pdf").on("click",function(){d.downloadData("pdf")})})}();
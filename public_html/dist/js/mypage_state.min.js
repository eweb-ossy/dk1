!function(){function a(e,t){if((t=(t=(t=(t=(t=(t=t.replace(/YYYY/g,e.getFullYear())).replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+e.getDate()).slice(-2))).replace(/hh/g,("0"+e.getHours()).slice(-2))).replace(/mm/g,("0"+e.getMinutes()).slice(-2))).replace(/ss/g,("0"+e.getSeconds()).slice(-2))).match(/S/g))for(var a=("00"+e.getMilliseconds()).slice(-3),o=t.match(/S/g).length,r=0;r<o;r++)t=t.replace(/S/,a.substring(r,r+1));return t}function e(e,t,a){switch(a){case"YYYY":e.setYear(e.getYear()+t);break;case"MM":e.setMonth(e.getMonth()+t);break;case"hh":e.setHours(e.getHours()+t);break;case"mm":e.setMinutes(e.getMinutes()+t);break;case"ss":e.setSeconds(e.getSeconds()+t);break;default:e.setDate(e.getDate()+t)}return e}var o,r,n,u,d,i,l,t=0,s={},_={},c=function(){return $.ajax({url:"../data/columns/list_day",dataType:"json"})},m=function(){return $.ajax({type:"POST",dataType:"json",url:"../../data/admin_list_day/save",data:{today:a(new Date(n),"YYYY-MM-DD"),user_id:s.user_id,in_time:$("#picker_in_time").val(),out_time:$("#picker_out_time").val(),rest:$("#rest_range").val(),memo:$("#memo").val(),area_id:$('select[name="place"] option:selected').attr("data-area-id"),flag:"mypage"}})},h=function(){var e={system_id:sysId,user_id:userId};socket.emit("notice_client_to_server",e),socket.on("notice_server_to_client",function(e){var l=0,u=0;$.each(e,function(e,t){if(t.user_id!=userId&&t.high_user_id.indexOf(String(userId))<0)return!0;0==t.notice_status&&l++,1==t.notice_status&&(t.user_id,userId),2==t.notice_status&&(t.user_id,userId,u++),t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.user_id!=userId&&(t.user_id,t.user_name);var a=new Date(t.to_date),o=a.getFullYear(),r=a.getMonth()+1,n=a.getDate(),i=["日","月","火","水","木","金","土"][a.getDay()];("0"+r).slice(-2),("0"+n).slice(-2);t.end_date&&(o=(a=new Date(t.end_date)).getFullYear(),r=a.getMonth()+1,n=a.getDate(),i=["日","月","火","水","木","金","土"][a.getDay()],("0"+r).slice(-2),("0"+n).slice(-2))}),$("#notice_count_new, .badge-text1").hide(),$("#notice_count_ng, .badge-text2").hide(),0<l&&($("#notice_count_new, .badge-text1").show(),$("#notice_count_new").text(l)),0<u&&($("#notice_count_ng, .badge-text2").show(),$("#notice_count_ng").text(u))})},f=function(e){var e="../../data/admin_download/"+e,t=document.createElement("form"),e=(t.setAttribute("action",e),t.setAttribute("method","post"),t.style.display="none",document.body.appendChild(t),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","column"),e.setAttribute("value",JSON.stringify(i)),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","dl_data"),e.setAttribute("value",JSON.stringify(l)),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","type"),e.setAttribute("value","day"),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","data_date"),e.setAttribute("value",$("#datepicker").val()),t.appendChild(e),document.createElement("input"));e.setAttribute("type","hidden"),e.setAttribute("name","all_data"),e.setAttribute("value",JSON.stringify(_)),t.appendChild(e),t.submit()},g=function(e){var t=e.filter(function(e){return 0<e.work_hour2}),t=(_.work_minute=t.reduce(function(e,t){return e+Number(t.work_hour2)},0),0<_.work_minute?_.work_hour=Math.floor(_.work_minute/60)+":"+("0"+_.work_minute%60).slice(-2):_.work_hour="",e.filter(function(e){return 0<e.normal_hour2})),t=(_.normal_minute=t.reduce(function(e,t){return e+Number(t.normal_hour2)},0),0<_.normal_minute?_.normal_hour=Math.floor(_.normal_minute/60)+":"+("0"+_.normal_minute%60).slice(-2):_.normal_hour="",e.filter(function(e){return 0<e.shift_hour2})),t=(_.shift_hour2=t.reduce(function(e,t){return e+Number(t.shift_hour2)},0),0<_.shift_hour2?_.shift_hour=Math.floor(_.shift_hour2/60)+":"+("0"+_.shift_hour2%60).slice(-2):_.shift_hour="",e.filter(function(e){return 0<e.rest_hour2})),t=(_.rest_minute=t.reduce(function(e,t){return e+Number(t.rest_hour2)},0),0<_.rest_minute?_.rest_hour=Math.floor(_.rest_minute/60)+":"+("0"+_.rest_minute%60).slice(-2):_.rest_hour="",e.filter(function(e){return 0<e.over_hour2})),t=(_.over_minute=t.reduce(function(e,t){return e+Number(t.over_hour2)},0),0<_.over_minute?_.over_hour=Math.floor(_.over_minute/60)+":"+("0"+_.over_minute%60).slice(-2):_.over_hour="",e.filter(function(e){return 0<e.night_hour2})),t=(_.night_minute=t.reduce(function(e,t){return e+Number(t.night_hour2)},0),0<_.night_minute?_.night_hour=Math.floor(_.night_minute/60)+":"+("0"+_.night_minute%60).slice(-2):_.night_hour="",e.filter(function(e){return 0<e.late_hour2})),t=(_.late_minute=t.reduce(function(e,t){return e+Number(t.late_hour2)},0),0<_.late_minute?_.late_hour=Math.floor(_.late_minute/60)+":"+("0"+_.late_minute%60).slice(-2):_.late_hour="",e.filter(function(e){return 0<e.left_hour2}));_.left_minute=t.reduce(function(e,t){return e+Number(t.left_hour2)},0),0<_.left_minute?_.left_hour=Math.floor(_.left_minute/60)+":"+("0"+_.left_minute%60).slice(-2):_.left_hour=""};function p(e){var t=[];if(0<e.length){for(var a=0;a<e.length;a++)t.push(e[a]._row.data);g(t),l=t}}var b={renderTableColumns:new Promise(function(t,e){c().done(function(e){i=e,o=new Tabulator("#data_table",{height:"calc(100vh - 142px)",columns:e,tooltips:function(e){var t=e.getColumn(),t=("in_work_time"!=t._column.field&&"out_work_time"!=t._column.field&&"work_hour"!=t._column.field&&"work_minute"!=t._column.field&&"rest_hour"!=t._column.field&&"rest_minute"!=t._column.field&&"status"!=t._column.field||(e.getElement().style.color="#1591a2"),"over_hour"!=t._column.field&&"over_minute"!=t._column.field&&"night_hour"!=t._column.field&&"night_minute"!=t._column.field&&"late_hour"!=t._column.field&&"late_minute"!=t._column.field&&"left_hour"!=t._column.field&&"left_minute"!=t._column.field||(e.getElement().style.color="#ff4560"),"normal_hour"!=t._column.field&&"normal_minute"!=t._column.field||(e.getElement().style.color="#673AB7"),"shift_in_time"!=t._column.field&&"shift_out_time"!=t._column.field&&"shift_hour"!=t._column.field||(e.getElement().style.color="#9abcea"),e.getValue());"片打刻"==t&&(e.getElement().style.color="#ff4560"),"未出勤"==t&&(e.getElement().style.color="#673ab7"),"出勤"==t&&(e.getElement().style.color="#9abcea"),"公休"==t&&(e.getElement().style.color="#F44336"),"有給"!=t&&"有給取得"!=t||(e.getElement().style.color="#fff",e.getElement().style.background="#40a598"),"欠勤"==t&&(e.getElement().style.color="#fff",e.getElement().style.background="#fd6b80")},dataFiltered:function(e,t){var a=[];if(0<t.length){for(var o=0;o<t.length;o++)a.push(t[o]._row.data);g(a),b.renderListData()}p(t)},dataSorted:function(e,t){var a=[];if(0<t.length){for(var o=0;o<t.length;o++)a.push(t[o]._row.data);g(a),b.renderListData()}p(t)},rowClick:function(e,t){(s=t.getData()).user_id&&0!==edit_flag&&b.render_modal(s)},invalidOptionWarnings:!1}),t(),o.hideColumn("work_hour2"),o.hideColumn("rest_hour2"),o.hideColumn("over_hour2"),o.hideColumn("night_hour2"),o.hideColumn("group1_order"),o.hideColumn("group2_order"),o.hideColumn("group3_order"),o.hideColumn("in_latitude"),o.hideColumn("in_longitude"),o.hideColumn("out_latitude"),o.hideColumn("out_longitude"),o.hideColumn("area_id"),o.hideColumn("normal_hour2"),o.hideColumn("shift_hour2"),o.hideColumn("shift_rest"),1===mypage_status_inout_view_flag&&(o.hideColumn("in_work_time"),o.hideColumn("out_work_time")),2===mypage_status_inout_view_flag&&(o.hideColumn("in_time"),o.hideColumn("out_time")),o.hideColumn("group1_name"),o.hideColumn("group2_name"),o.hideColumn("group3_name")})}),renderDate:new Promise(function(e,t){r=flatpickr("#datepicker",{locale:{firstDayOfWeek:0},dateFormat:"Y年m月d日(D)",defaultDate:"today",onChange:function(){n=r.selectedDates[0],b.renderTableData()}}),e()}),renderTableData:function(){r.setDate(n);var e=a(new Date(n),"YYYY-MM-DD"),t=(e===a(new Date,"YYYY-MM-DD")?($("#date_today").addClass("disable"),$("#today_mark").addClass("today"),$("#today_mark").text("本日")):($("#date_today").removeClass("disable"),$("#today_mark").removeClass("today"),0<(t=Math.ceil((n-new Date)/864e5))?$("#today_mark").text(t+"日後"):$("#today_mark").text(Math.abs(t)+"日前")),new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{era:"long",year:"numeric"}).format(new Date(n)));$("#date-area-wareki").text(t),o.clearData(),o.replaceData("../data/admin_list_day/table_data",{date:e,user_id:userId},"POST")},render_modal:function(e){$("#shift_view_btn").hide(),$("#modal_date").text($("#datepicker").val());var t=e.in_work_time||"",t=(u=flatpickr("#picker_in_time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,defaultHour:defaultInHour,defaultMinute:defaultInMinute,minuteIncrement:defaultMinuteIncrement,defaultDate:t,onChange:function(){b.render_modal_check()},onClose:function(){b.render_modal_check()}}),d=flatpickr("#picker_out_time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,defaultHour:defaultOutHour,defaultMinute:defaultOutMinute,minuteIncrement:defaultMinuteIncrement,defaultDate:e.out_work_time,onChange:function(){b.render_modal_check()},onClose:function(){b.render_modal_check()}}),e.in_work_time||"--"),t=($("#in_time").text(t),e.out_work_time||"--"),t=($("#out_time").text(t),e.work_hour2?e.work_hour2+"分":"--"),t=($("#work_value").text(t),e.work_hour||""),t=($("#work_value2").text(t),$("#rest_range").prop("disabled",!1).val(Number(e.rest_hour2)),e.rest_hour2||0),t=(b.render_rest_btn(t),e.rest_hour||"0:00"),t=($("#rest_value2").text(t),(e.area?$('[name="place"] > option[value="'+e.area+'"]'):$('[name="place"] > option[value=""]')).prop("selected",!0),$("#memo").val(e.memo),$(".iziModal-header-title").text(e.user_name),$('[tabulator-field="group1_name"] > .tabulator-col-content > .tabulator-col-title').text()),a=$('[tabulator-field="group2_name"] > .tabulator-col-content > .tabulator-col-title').text(),o=$('[tabulator-field="group3_name"] > .tabulator-col-content > .tabulator-col-title').text();$(".iziModal-header-subtitle").text("ID："+e.user_id+"　"+t+"："+e.group1_name+"　"+a+"："+e.group2_name+"　"+o+"："+e.group3_name),e.in_latitude&&e.in_longitude?$("#map_in").html('<iframe src="https://maps.google.co.jp/maps?output=embed&t=m&hl=ja&z=15&ll='+e.in_latitude+","+e.in_longitude+"&q="+e.in_latitude+","+e.in_longitude+'" frameborder="0" scrolling="no" width="323px" height="78px"></iframe>'):$("#map_in").html(""),e.out_latitude&&e.out_longitude?$("#map_out").html('<iframe src="https://maps.google.co.jp/maps?output=embed&t=m&hl=ja&z=15&ll='+e.out_latitude+","+e.out_longitude+"&q="+e.out_latitude+","+e.out_longitude+'" frameborder="0" scrolling="no" width="323px" height="78px"></iframe>'):$("#map_out").html(""),$("#time_edit_submit").attr("data-user-id",e.user_id),$("#time_edit_submit").addClass("disable"),$("#modal2").iziModal("open")},render_rest_btn:function(e){$(".r_btn").removeClass("active"),$("#rest_"+e).addClass("active"),$("#memori_"+e).addClass("active"),$("#rest_value").text(e+"分");var t=e/60,a=Math.floor(t),t=Math.round(60*(t-a));$("#rest_value2").text(a+":"+("0"+t).slice(-2)),$("#rest_range").val(e),b.render_modal_check()},render_modal_check:function(){$("#time_edit_submit").addClass("disable"),$(".time-input, .rest-value, .shift-rest-value").removeClass("error"),$("#work_value, #shift_value").text("--"),$("#work_value2, #shift_value2").text("");var e=new Date(u.selectedDates).getHours(),t=60*e+new Date(u.selectedDates).getMinutes(),a=new Date(d.selectedDates).getHours(),o=60*a+new Date(d.selectedDates).getMinutes(),r=$("#picker_in_time").val(),n=$("#picker_out_time").val(),e=(0<over_day&&(e<=over_day&&(t+=1440,i=r.substr(0,2),l=r.substr(-2),r=(i=Number(i)+24)+":"+l),a<=over_day&&(o+=1440,i=n.substr(0,2),l=n.substr(-2),n=(i=Number(i)+24)+":"+l)),$("#rest_range").val());if(!t&&!o&&0<e)$(".rest-value").addClass("error");else if(t&&!o&&0<e)$(".rest-value").addClass("error");else if(!t&&o||!t&&0===o)$("#picker_in_time").addClass("error"),0<e&&$(".rest-value").addClass("error");else{if(t&&o){a=o-t;if(a-e<=0)return void $("#picker_out_time").addClass("error");if(a<=e)return void $(".rest-value").addClass("error");a-=e,$("#work_value").text(a+"分");var i=a/60,l=Math.floor(i),o=Math.round(60*(i-l));$("#work_value2").text(l+":"+("0"+o).slice(-2))}s.in_work_time!=r&&$("#time_edit_submit").removeClass("disable"),s.out_work_time!=n&&$("#time_edit_submit").removeClass("disable");(s.rest_hour2||0)!=e&&$("#time_edit_submit").removeClass("disable");t=$('select[name="place"] option:selected').attr("data-area-id"),a=(s.area_id!=t&&$("#time_edit_submit").removeClass("disable"),$("#memo").val());s.memo!=a&&$("#time_edit_submit").removeClass("disable")}},show_toast:function(e){siiimpleToast.message(e,{position:"top|right"})},show_err_toast:function(e){siiimpleToast.alert(e,{position:"top|right"})},renderListData:function(){setTimeout(function(){$('.tabulator-calcs-top > [tabulator-field="user_id"]').text("合計"),$('.tabulator-calcs-top > [tabulator-field="work_hour"]').text(_.work_hour),$('.tabulator-calcs-top > [tabulator-field="work_minute"]').text(_.work_minute),$('.tabulator-calcs-top > [tabulator-field="rest_hour"]').text(_.rest_hour),$('.tabulator-calcs-top > [tabulator-field="rest_minute"]').text(_.rest_minute),$('.tabulator-calcs-top > [tabulator-field="late_hour"]').text(_.late_hour),$('.tabulator-calcs-top > [tabulator-field="late_minute"]').text(_.late_minute),$('.tabulator-calcs-top > [tabulator-field="left_hour"]').text(_.left_hour),$('.tabulator-calcs-top > [tabulator-field="left_minute"]').text(_.left_minute),$('.tabulator-calcs-top > [tabulator-field="over_hour"]').text(_.over_hour),$('.tabulator-calcs-top > [tabulator-field="over_minute"]').text(_.over_minute),$('.tabulator-calcs-top > [tabulator-field="night_hour"]').text(_.night_hour),$('.tabulator-calcs-top > [tabulator-field="night_minute"]').text(_.night_minute),$('.tabulator-calcs-top > [tabulator-field="normal_hour"]').text(_.normal_hour),$('.tabulator-calcs-top > [tabulator-field="normal_minute"]').text(_.normal_minute),$('.tabulator-calcs-top > [tabulator-field="shift_hour"]').text(_.shift_hour)},100)}};$(function(){h(),$(document).on("click",".navbar-toggler",function(){var e;t=1===t?($("html").removeClass("nav-open"),$(".close-layer").remove(),setTimeout(function(){$(this).removeClass("toggled")},400),0):(setTimeout(function(){$(this).addClass("toggled")},430),e=$('<div class="close-layer"></div>'),0!=$("body").find(".main-panel").length?e.appendTo(".main-panel"):$("body").hasClass("off-canvas-sidebar")&&e.appendTo(".wrapper-full-page"),setTimeout(function(){e.addClass("visible")},100),e.click(function(){$("html").removeClass("nav-open"),t=0,e.removeClass("visible"),setTimeout(function(){e.remove(),$(this).removeClass("toggled")},400)}),$("html").addClass("nav-open"),1)}),Promise.all([b.renderTableColumns,b.renderDate]).then(function(){n=r.selectedDates[0],b.renderTableData()}),$("#modal2").iziModal({headerColor:"#1591a2",focusInput:!1,width:700}),$(document).delegate("#less_day","click",function(){n=e(new Date(n),-1),b.renderTableData()}),$(document).delegate("#add_day","click",function(){n=e(new Date(n),1),b.renderTableData()}),$(document).delegate("#today_mark, #date_today","click",function(){n=new Date,b.renderTableData()}),$("#table_window_btn").on("click",function(){$(this).toggleClass("on"),o.toggleColumn("group1_name"),o.toggleColumn("group2_name"),o.toggleColumn("group3_name")}),$(document).delegate("#rest_range","input",function(){var e=$(this).val();b.render_rest_btn(e)}),$(document).delegate(".r_btn","click",function(){var e=$(this).attr("data-time");b.render_rest_btn(e)}),$(document).delegate(".time-val","input change",function(){b.render_modal_check()}),$(document).delegate("#picker_del_in_time","click",function(){u.clear(),b.render_modal_check()}),$(document).delegate("#picker_del_out_time","click",function(){d.clear(),b.render_modal_check()}),$(document).delegate("#shift_view_btn","click",function(){$(this).toggleClass("active-shift"),$("#shift_btn_area").slideToggle(),b.render_shift_btn(s.shift_status)}),$(document).delegate(".shift-btn","click",function(){b.render_shift_btn($(this).text())}),$(document).delegate("#shift_rest_range","input",function(){var e=$(this).val();b.render_shift_rest_btn(e)}),$(document).delegate(".rs_btn","click",function(){var e=$(this).attr("data-time");b.render_shift_rest_btn(e)}),$(document).delegate("#picker_shift_del_in_time","click",function(){timepicker_shift_in.clear(),b.render_modal_check()}),$(document).delegate("#picker_shift_del_out_time","click",function(){timepicker_shift_out.clear(),b.render_modal_check()}),$(document).delegate("#time_edit_submit","click",function(){m().done(function(e){"ok"===e.message?($("#modal2").iziModal("close"),b.show_toast(e.today+" 修正登録 "+s.user_name+" "+e.user_id),b.renderTableData()):b.show_err_toast("通信エラー")}).fail(function(){b.show_err_toast("通信エラー")})}),$(document).on("click",".header-menu-btn",function(){$(this).next(".dropdown-menu").toggleClass("show")}),$(document).click(function(e){$(e.target).closest(".dropdown-menu").length||$(e.target).closest(".header-menu-btn").length||$(".dropdown-menu").removeClass("show")}),$(document).on("click",".dropdown-item",function(){Cookies.set("notice_id",$(this).attr("id")),location.href="/mypage_notice"}),$("#download_btn_excel").on("click",function(){f("xlsx")}),$("#download_btn_pdf").on("click",function(){f("pdf")})})}();
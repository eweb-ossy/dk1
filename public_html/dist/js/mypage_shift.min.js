!function(){function s(e,t){if((t=(t=(t=(t=(t=(t=t.replace(/YYYY/g,e.getFullYear())).replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+e.getDate()).slice(-2))).replace(/hh/g,("0"+e.getHours()).slice(-2))).replace(/mm/g,("0"+e.getMinutes()).slice(-2))).replace(/ss/g,("0"+e.getSeconds()).slice(-2))).match(/S/g))for(var a=("00"+e.getMilliseconds()).slice(-3),n=t.match(/S/g).length,i=0;i<n;i++)t=t.replace(/S/,a.substring(i,i+1));return t}function t(e,t,a){switch(a){case"YYYY":e.setYear(e.getYear()+t);break;case"MM":e.setMonth(e.getMonth()+t);break;case"hh":e.setHours(e.getHours()+t);break;case"mm":e.setMinutes(e.getMinutes()+t);break;case"ss":e.setSeconds(e.getSeconds()+t);break;default:e.setDate(e.getDate()+t)}return e}var n,o,r,d,a=0,i=new Date,c=(i.setDate(1),0),u=function(){var e={system_id:sysId,user_id:userId};socket.emit("notice_client_to_server",e),socket.on("notice_server_to_client",function(e){var r=0,d=0;$.each(e,function(e,t){if(t.user_id!=userId&&t.high_user_id.indexOf(String(userId))<0)return!0;0==t.notice_status&&r++,1==t.notice_status&&(t.user_id,userId),2==t.notice_status&&(t.user_id,userId,d++),t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.user_id!=userId&&(t.user_id,t.user_name);var a=new Date(t.to_date),n=a.getFullYear(),i=a.getMonth()+1,s=a.getDate(),o=["日","月","火","水","木","金","土"][a.getDay()];("0"+i).slice(-2),("0"+s).slice(-2);t.end_date&&(n=(a=new Date(t.end_date)).getFullYear(),i=a.getMonth()+1,s=a.getDate(),o=["日","月","火","水","木","金","土"][a.getDay()],("0"+i).slice(-2),("0"+s).slice(-2))}),$("#notice_count_new, .badge-text1").hide(),$("#notice_count_ng, .badge-text2").hide(),0<r&&($("#notice_count_new, .badge-text1").show(),$("#notice_count_new").text(r)),0<d&&($("#notice_count_ng, .badge-text2").show(),$("#notice_count_ng").text(d))})},l=function(){return $.ajax({type:"POST",dataType:"json",url:"../data/admin_shift/table_shift_data",data:{year:s(new Date(i),"YYYY"),month:s(new Date(i),"MM"),user_id:userId,flag:"cal"}})},_=function(){for(var e=n.getEventSources(),t=e.length,a=0;a<t;a++)e[a].remove()},h=function(){return $.ajax({type:"POST",dataType:"json",url:"../data/admin_shift/calHoriday",data:{year:s(new Date(i),"YYYY"),month:s(new Date(i),"MM")}})},e=function(){return $.ajax({type:"POST",dataType:"json",url:"../data/admin_shift/workStatus",data:{year:s(new Date(i),"YYYY"),month:s(new Date(i),"MM"),user_id:userId}})},m=function(e){var t=$('[name="status"]:checked').val(),a="",n="";return 0==t&&(a=o.getHour()+":"+o.getMinute()+":00",n=r.getHour()+":"+r.getMinute()+":00"),$.ajax({type:"POST",url:"../data/admin_shift/saveRegister",data:{user_id:userId,dk_date:e,shift_status:t,in_time:a,out_time:n}})},f=function(){return $.ajax({type:"POST",dataType:"json",url:"../data/admin_shift/registerStatus",data:{user_id:userId,year:s(new Date(i),"YYYY"),month:s(new Date(i),"MM"),flag:"mypage"}})},g=function(){return $.ajax({type:"POST",url:"../data/admin_shift/saveUndataChange",data:{user_id:userId,year:s(new Date(i),"YYYY"),month:s(new Date(i),"MM")}})},Y=function(){return $.ajax({type:"POST",url:"../data/admin_shift/saveUndataDel",data:{user_id:userId,year:s(new Date(i),"YYYY"),month:s(new Date(i),"MM")}})},p={renderDate:function(){var e,t,a,n=new Date(i);a=0<mypage_end_day?((a=new Date(i)).setMonth(a.getMonth()-1),e=mypage_end_day+1,e=s(a,"YYYY年MM月")+e+"日",t=s(n,"YYYY年MM月")+mypage_end_day+"日",new Date(a.getFullYear(),a.getMonth()+1,0).getDate()-mypage_end_day+mypage_end_day):(e=s(n,"YYYY年MM月")+"01日",t=s(new Date(n.getFullYear(),n.getMonth()+1,0),"YYYY年MM月DD日"),new Date(n.getFullYear(),n.getMonth()+1,0).getDate()),$("#to_from_date").text(e+"から"+t+"までの"+a+"日間"),$("#month").val(s(new Date(i),"YYYY年MM月")),s(new Date(i),"YYYY-MM")===s(new Date,"YYYY-MM")?($("#this_month").addClass("disable"),$("#this_month_mark").addClass("this-month"),$("#this_month_mark").text("今月"),c=0):($("#this_month").removeClass("disable"),$("#this_month_mark").removeClass("this-month"),0<c?$("#this_month_mark").text(c+"ヶ月後"):$("#this_month_mark").text(Math.abs(c)+"ヶ月前"))},renderSelect:function(e){o.setHour(shift_first_hour),o.setMinute(0),r.setHour(shift_end_hour),r.setMinute(0);var t=new Date(e.event.start),a=s(t,"YYYY年MM月DD日"),n=s(t,"YYYY-MM-DD"),i=["（日）","（月）","（火）","（水）","（木）","（金）","（土）"][t.getDay()];$("#list_date").html('<i class="fas fa-calendar-check"></i> '+a+i),$("#shift_register_btn").attr("data-date",n),t<new Date?($("#statue_area").hide(),$("#time_area").hide(),$("#shift_register_btn").addClass("disabled")):($("#statue_area").show(),$("#shift_register_btn").removeClass("disabled"),a=e.event.id,$(".radio-text").removeClass("on"),1<a.length&&($("#status_0").prop("checked",!0),$("#time_area").show(),$("#status_0").next("label").addClass("on"),i=a.split(":"),o.setTime(Number(i[0]),Number(i[1])),r.setTime(Number(i[2]),Number(i[3]))),1==a&&($("#status_1").prop("checked",!0),$("#time_area").hide(),$("#status_1").next("label").addClass("on")),2==a&&($("#status_2").prop("checked",!0),$("#time_area").hide(),$("#status_2").next("label").addClass("on")),0==a&&($("#status_none").prop("checked",!0),$("#time_area").hide(),$("#status_none").next("label").addClass("on")))},rendar_cal_holiday:function(e){$(".holiday").html(""),$.each(e,function(e,t){$('.fc-day-top[data-date="'+t.date+'"]').prepend('<span class="holiday">'+t.holiday+"</span>"),t.holiday&&$('.fc-day-top[data-date="'+t.date+'"] > .fc-day-number').css("color","#ff7d73")})},render_undata_change_btn:function(e){var a=[],n=($.each(e,function(e,t){a.push(t.start)}),s(new Date,"YYYY-MM-DD")),i=($("#undata_change_btn").addClass("disabled"),0);$.each(d,function(e,t){-1==a.indexOf(t.start)&&t.start>n&&"・未登録"===t.title&&i++}),0<i&&$("#undata_change_btn").removeClass("disabled")},render_cal_data:function(){e().done(function(e){_(),n.addEventSource(e),l().done(function(e){n.addEventSource(e),d=e,f().done(function(e){p.render_undata_change_btn(e),n.addEventSource(e)})})})}};$(function(){$(document).on("click",".navbar-toggler",function(){var e;a=1===a?($("html").removeClass("nav-open"),$(".close-layer").remove(),setTimeout(function(){$(this).removeClass("toggled")},400),0):(setTimeout(function(){$(this).addClass("toggled")},430),e=$('<div class="close-layer"></div>'),0!=$("body").find(".main-panel").length?e.appendTo(".main-panel"):$("body").hasClass("off-canvas-sidebar")&&e.appendTo(".wrapper-full-page"),setTimeout(function(){e.addClass("visible")},100),e.click(function(){$("html").removeClass("nav-open"),a=0,e.removeClass("visible"),setTimeout(function(){e.remove(),$(this).removeClass("toggled")},400)}),$("html").addClass("nav-open"),1)}),u(),p.renderDate(),h().done(function(e){p.rendar_cal_holiday(e)}),p.render_cal_data();var e=document.getElementById("calendar");(n=new FullCalendar.Calendar(e,{plugins:["dayGrid"],timeZone:"local",defaultView:"dayGridMonth",locale:"ja",firstDay:shift_cal_first_day,header:{left:"",center:"",right:""},eventClick:function(e){$(".fc-day-grid-event").css("opacity",1),$(".shift_today, .shift_past, .in-register").css("opacity",.5),e.el.style.opacity=.5,p.renderSelect(e)}})).render(),$("#less_month").on("click",function(e){i=t(new Date(i),-1,"MM"),c--,p.renderDate(),n.prev(),h().done(function(e){p.rendar_cal_holiday(e)}),p.render_cal_data()}),$("#add_month").on("click",function(e){i=t(new Date(i),1,"MM"),c++,p.renderDate(),n.next(),h().done(function(e){p.rendar_cal_holiday(e)}),p.render_cal_data()}),$("#this_month_mark, #this_month").on("click",function(e){(i=new Date).setDate(1),p.renderDate(),n.today(),h().done(function(e){p.rendar_cal_holiday(e)}),p.render_cal_data()}),$(document).on("change",'[name="status"]',function(){$(".radio-text").removeClass("on"),$(this).next("label").addClass("on");var e=$(this).val();$("#time_area").hide(),0==e&&$("#time_area").show()}),$(document).on("click","#shift_register_btn",function(){var e=$(this).attr("data-date");m(e).done(function(e){"ok"===e&&p.render_cal_data(),$("#list_date").html('<i class="fas fa-calendar"></i> カレンダーを選択'),$("#statue_area, #time_area").hide(),$("#shift_register_btn").addClass("disabled"),o.setHour(shift_first_hour),o.setMinute(0),r.setHour(shift_end_hour),r.setMinute(0)})}),$(document).on("click",".header-menu-btn",function(){$(this).next(".dropdown-menu").toggleClass("show")}),$(document).on("click",function(e){$(e.target).closest(".dropdown-menu").length||$(e.target).closest(".header-menu-btn").length||$(".dropdown-menu").removeClass("show")}),$(document).on("click",".dropdown-item",function(){Cookies.set("notice_id",$(this).attr("id")),location.href="/mypage_notice"}),$(document).on("click","#undata_change_btn",function(){g().done(function(e){"ok"===e&&p.render_cal_data()})}),$(document).on("click","#del_btn",function(){Y().done(function(e){"ok"===e&&p.render_cal_data()})}),tui.TimePicker;o=new tui.TimePicker("#in_time_picker",{initialHour:15,initialMinute:13,inputType:"spinbox",showMeridiem:!1,initialHour:shift_first_hour,minuteStep:shift_input_hour}),r=new tui.TimePicker("#out_time_picker",{initialHour:15,initialMinute:13,inputType:"spinbox",showMeridiem:!1,initialHour:shift_end_hour,minuteStep:shift_input_hour})})}();
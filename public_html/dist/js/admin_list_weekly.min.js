!function(){function l(e,t){if((t=(t=(t=(t=(t=(t=t.replace(/YYYY/g,e.getFullYear())).replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+e.getDate()).slice(-2))).replace(/hh/g,("0"+e.getHours()).slice(-2))).replace(/mm/g,("0"+e.getMinutes()).slice(-2))).replace(/ss/g,("0"+e.getSeconds()).slice(-2))).match(/S/g))for(var a=("00"+e.getMilliseconds()).slice(-3),n=t.match(/S/g).length,s=0;s<n;s++)t=t.replace(/S/,a.substring(s,s+1));return t}function t(e,t,a){switch(a){case"YYYY":e.setYear(e.getYear()+t);break;case"MM":e.setMonth(e.getMonth()+t);break;case"hh":e.setHours(e.getHours()+t);break;case"mm":e.setMinutes(e.getMinutes()+t);break;case"ss":e.setSeconds(e.getSeconds()+t);break;default:e.setDate(e.getDate()+t)}return e}function a(e){var t=(e=e||new Date).getFullYear(),a=e.getMonth(),n=(e=e.getDate()-e.getDay()+firstDayOfWeek)+6,s=new String("日月火水木金土"),c=(e=new Date(t,a,e)).getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日("+s.charAt(e.getDay())+")",t=new Date(t,a,n),a=c+" ～ "+(t.getFullYear()+"年"+(t.getMonth()+1)+"月"+t.getDate()+"日("+s.charAt(t.getDay())+")");return l(e,"YYYY-MM-DD"),l(t,"YYYY-MM-DD"),a}var n,s,e=function(){return $.ajax({url:"../data/columns/list_weekly",dataType:"json"})},c=function(e){new Tabulator("#data_table",{height:"calc(100vh - 259px)",columns:e})},r=function(){s=(n=flatpickr("#datepicker",{plugins:[new weekSelect({})],locale:{firstDayOfWeek:firstDayOfWeek},dateFormat:"Y年 第W週",defaultDate:"today",onChange:function(){s=n.selectedDates[0];var e=a(s);$("#to_from_date").text(e)}})).selectedDates[0]},o=function(e){e=e||new Date,n.setDate(e);var t=a(e);$("#to_from_date").text(t),l(new Date(e),"YYYY-MM-DD")===l(new Date,"YYYY-MM-DD")?($("#date_weekly").addClass("disable"),$("#today_mark").addClass("today"),$("#today_mark").text("今週")):($("#date_weekly").removeClass("disable"),$("#today_mark").removeClass("today"))};$(function(){r(),o(s),e().done(function(e){c(e)}),$("#less_weekly").on("click",function(e){s=t(new Date(s),-7),o(s)}),$("#add_weekey").on("click",function(e){s=t(new Date(s),7),o(s)}),$(document).delegate("#today_mark, #date_weekly","click",function(){s=new Date,o(s)})})}();
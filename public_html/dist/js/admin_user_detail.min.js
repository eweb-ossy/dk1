!function(){var i,t,n,o,r,s,g=[],f=0,u="new";Cookies.get("userDetailUserId")&&(u=Cookies.get("userDetailUserId")),s=Cookies.get("userDetailTabKey")&&"new"!==u?Cookies.get("userDetailTabKey"):"01";function h(e,a){if((a=(a=(a=(a=(a=(a=a.replace(/YYYY/g,e.getFullYear())).replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+e.getDate()).slice(-2))).replace(/hh/g,("0"+e.getHours()).slice(-2))).replace(/mm/g,("0"+e.getMinutes()).slice(-2))).replace(/ss/g,("0"+e.getSeconds()).slice(-2))).match(/S/g))for(var t=("00"+e.getMilliseconds()).slice(-3),n=a.match(/S/g).length,i=0;i<n;i++)a=a.replace(/S/,t.substring(i,i+1));return a}function v(e){var e=new Date(e),a=e.getFullYear().toString().padStart(4,"0"),t=(e.getMonth()+1).toString().padStart(2,"0"),e=e.getDate().toString().padStart(2,"0"),n=new Date,i=n.getFullYear().toString().padStart(4,"0"),o=(n.getMonth()+1).toString().padStart(2,"0"),n=n.getDate().toString().padStart(2,"0");return Math.floor((Number(i+o+n)-Number(a+t+e))/1e4)}var d=function(){return $.ajax({url:"../../data/admin_user_detail/user_data",dataType:"json",type:"POST",data:{user_id:u}})},p=function(){return $.ajax({url:"../../data/admin_user_detail/group_data",dataType:"json",type:"POST"})},l=function(){var e=(e=$('input[name="user_id"]').val()).trim(),a=new Date(datepicker1.selectedDates),t=a.getFullYear(),n=a.getMonth()+1,i=a.getDate();t=isNaN(t)?"":t+"-"+n+"-"+i;var n=(a=new Date(datepicker2.selectedDates)).getFullYear(),i=a.getMonth()+1,a=a.getDate();return n=isNaN(n)?"":n+"-"+i+"-"+a,$.ajax({type:"POST",dataType:"json",url:"../../data/admin_user_detail/save_page_01",data:{flag:r,id:$('input[name="id"]').val(),user_id:e,name_sei:$('input[name="name_sei"]').val(),name_mei:$('input[name="name_mei"]').val(),kana_sei:$('input[name="kana_sei"]').val(),kana_mei:$('input[name="kana_mei"]').val(),state:$('input[name="state"]:checked').val(),sex:$('select[name="sex"] option:selected').val(),entry_date:t,resign_date:n,user_password:$('input[name="user_password"]').val(),shift_alert_flag:$('input[name="shift_alert_flag"]:checked').val(),management_flag:$('input[name="management_flag"]:checked').val(),input_confirm_flag:$('input[name="input_confirm_flag"]:checked').val()}})},_=function(){for(var e=[],a=[],t=[],n=0;n<f;n++)e[n]=$('input[name="group_history_id_'+n+'"]').val(),a[n]=h(new Date(g[n].selectedDates[0]),"YYYY-MM-DD"),t[n]=[$('[name="group1_'+n+'"]').val(),$('[name="group2_'+n+'"]').val(),$('[name="group3_'+n+'"]').val()];return $.ajax({type:"POST",dateType:"json",url:"../../data/admin_user_detail/save_page_02",data:{id:$('input[name="id"]').val(),user_id:u,group_history_id:e,group_history_to_date:a,group_history_groups:t}})},m=function(e){return $.ajax({type:"POST",dataType:"json",url:"../../data/admin_user_detail/del_page_02",data:{id:e}})},c=function(){var e=new Date(datepicker3.selectedDates),a=e.getFullYear(),t=e.getMonth()+1,e=e.getDate();return a=isNaN(a)?"":a+"-"+t+"-"+e,$.ajax({type:"POST",dataType:"json",url:"../../data/admin_user_detail/save_page_03",data:{id:$('input[name="id"]').val(),birth_date:a,phone_number1:$('input[name="phone_number1"]').val(),phone_number2:$('input[name="phone_number2"]').val(),email1:$('input[name="email1"]').val(),email2:$('input[name="email2"]').val(),zip_code:$('input[name="zip_code"]').val(),address:$('input[name="address"]').val()}})},D=function(){return $.ajax({url:"../../data/columns/user_detail_notice",dataType:"json",type:"POST"})},b=function(e){var a=(o=e).filter(function(e){return!0===e.notice}),a=(t=[],$.each(a,function(e,a){t.push(a.user_id)}),e.filter(function(e){return!0===e.permit})),e=(n=[],$.each(a,function(e,a){n.push(a.user_id)}),t.length);0<e?($("#notice_batch").text(e),$("#notice_batch").addClass("on")):$("#notice_batch").removeClass("on")},k=function(){return $.ajax({type:"POST",dataType:"json",url:"../../data/admin_user_detail/save_page_04",data:{user_id:u,notice_data:t,permit_data:n}})},Y=function(){return $.ajax({type:"POST",dataType:"json",url:"../../data/admin_user_detail/save_page_05",data:{id:$('input[name="id"]').val(),aporan_flag:$('input[name="aporan_flag"]:checked').val(),advance_pay_flag:$('input[name="advance_pay_flag"]:checked').val(),esna_pay_flag:$('input[name="esna_pay_flag"]:checked').val(),api_output:$('input[name="api_output"]:checked').val()}})},y=function(){return $.ajax({type:"POST",dataType:"json",url:"../../data/admin_user_detail/save_page_99",data:{user_id:u}})},T={renderTab:function(e){$(".tab-page").removeClass("active-page"),$("#page_"+e).addClass("active-page"),$(".tab").removeClass("active-menu"),$("#tab_"+e).addClass("active-menu")},renderUserData:function(){var e=$('input[name="kana_sei"]').val(),a=$('input[name="kana_mei"]').val(),t=$('input[name="name_sei"]').val(),n=$('input[name="name_mei"]').val(),i=$('input[name="user_id"]').val();e||a?$("#user_kana").text(e+" "+a):$("#user_kana").text(""),t||n?$("#user_name").text(t+" "+n):"new"===u?$("#user_name").text("新規従業員を登録します"):$("#user_name").text(""),i?$("#user_id").text(i):$("#user_id").text("")},renderUserDataForm:function(o){var e="0000-00-00"===o.entry_date?"":o.entry_date,a="0000-00-00"===o.resign_date?"":o.resign_date,t="0000-00-00"===o.birth_date?"":o.birth_date,n=($('input[name="id"]').val(o.id),null===o.kana_sei?"":o.kana_sei),i=null===o.kana_mei?"":o.kana_mei,r=($('input[name="user_id"]').val(o.user_id),$('input[name="name_sei"]').val(o.name_sei),$('input[name="name_mei"]').val(o.name_mei),$('input[name="kana_sei"]').val(n),$('input[name="kana_mei"]').val(i),$('[name="sex"] option[value="'+o.sex+'"]').prop("selected",!0),$('input[name="entry_date"]').val(e),$('[name="state"][value="'+o.state+'"]').prop("checked",!0),$('input[name="birth_date"]').val(t),$('input[name="phone_number1"]').val(o.phone_number1),$('input[name="phone_number2"]').val(o.phone_number2),$('input[name="email1"]').val(o.email1),$('input[name="email2"]').val(o.email2),$('input[name="zip_code"]').val(o.zip_code),$('input[name="address"]').val(o.address),$('[name="aporan_flag"][value="'+o.aporan_flag+'"]').prop("checked",!0),$('[name="advance_pay_flag"][value="'+o.advance_pay_flag+'"]').prop("checked",!0),$('[name="management_flag"][value="0"]').prop("checked",!0),$('[name="management_flag"][value="'+o.management_flag+'"]').prop("checked",!0),$('[name="esna_pay_flag"][value="'+o.esna_pay_flag+'"]').prop("checked",!0),$('[name="api_output"][value="'+o.api_output+'"]').prop("checked",!0),"2"===o.state?($("#resign_date_area").show(),$('input[name="resign_date"]').val(a)):$("#resign_date_area").hide(),datepicker1.setDate(e,"Y-m-d"),datepicker2.setDate(a,"Y-m-d"),datepicker3.setDate(t,"Y-m-d"),t?$("#old").text(v(t)+"歳"):$("#old").text(""),(!o.shift_alert_flag||0==o.shift_alert_flag?$('[name="shift_alert_flag"][value="0"]'):$('[name="shift_alert_flag"][value="2"]')).prop("checked",!0),(!o.input_confirm_flag||0==o.input_confirm_flag?$('[name="input_confirm_flag"][value="0"]'):$('[name="input_confirm_flag"][value="2"]')).prop("checked",!0),group2_option=group3_option='<option value="">---</option>'),s=[],u=[],d=[],p=($.each(o.group1,function(e,a){r+='<option value="'+a.id+'">'+a.group_name+"</option>",s[a.id]=a.group_name}),$.each(o.group2,function(e,a){group2_option+='<option value="'+a.id+'">'+a.group_name+"</option>",u[a.id]=a.group_name}),$.each(o.group3,function(e,a){group3_option+='<option value="'+a.id+'">'+a.group_name+"</option>",d[a.id]=a.group_name}),""),l={},_=[],m=[],c=[];$.each(o.group_history,function(e,a){var t,n="",i=(_[e]=a.to_date,"#fff");0===e?(n="現在","2"===o.state&&(n=o.resign_date+"退職"),0<a.group1_id&&(1,a.group1_id),0<a.group2_id&&(2,a.group2_id),0<a.group3_id&&(3,a.group3_id),i="#e7fffd",m[e]=h(new Date,"YYYY-MM-DD")):(t=_[e-1].split("-"),(t=new Date(t[0],t[1]-1,t[2])).setDate(t.getDate()-1),n=h(new Date(t),"YYYY年MM月DD日"),m[e]=h(new Date(t),"YYYY-MM-DD")),l[e]={group1:a.group1_id,group2:a.group2_id,group3:a.group3_id},p=(p=(p=(p=(p=p+('<input type="hidden" name="group_history_id_'+e+'" value="'+a.id)+'"><tr style="font-size:9px;background:'+i+'">')+'<td><i class="fas fa-calendar-alt"></i>&nbsp;<input class="field_page_02 group-pickr pickr_'+e+'" type="text" value="'+a.to_date+'" data-index="'+e+'"></td>')+'<td id="group_end_'+e+'">'+n+'</td><td><select name="group1_'+e+'" class="field_page_02">'+r+"</select></td>")+'<td><select name="group2_'+e+'" class="field_page_02">'+group2_option+"</select></td>")+'<td><select name="group3_'+e+'" class="field_page_02">'+group3_option+"</select></td>",e+1===o.group_history.length?p+='<td class="group-btn-area"></td>':p+='<td class="group-btn-area"><div class="btn red group-history-del" data-group-history-id="'+a.id+'">削除</div></td>',p+="</tr>",f++}),$("#group_body").html(p),$.each(l,function(e,a){$('[name="group1_'+e+'"]').val(a.group1),$('[name="group2_'+e+'"]').val(a.group2),$('[name="group3_'+e+'"]').val(a.group3),_[Number(e)+1]?((a=new Date(_[Number(e)+1])).setDate(a.getDate()+1),c[e]=h(new Date(a),"YYYY-MM-DD")):c[e]="1900-01-01",g[e]=flatpickr(".pickr_"+e,{dateFormat:"Y年m月d日",onChange:function(e,a,t){t=$(t.element).attr("data-index"),t=Number(t)+1,e=new Date(e);e.setDate(e.getDate()-1),$("#group_end_"+t).text(h(new Date(e),"YYYY年MM月DD日")),g[t]&&g[t].set("maxDate",h(new Date(e),"YYYY-MM-DD"))},maxDate:m[e],minDate:c[e]})})},addGroup:function(e){var t,a,n=h(new Date,"YYYY-MM-DD");h(new Date(g[0].selectedDates),"YYYY-MM-DD")!==n&&(t=group2_option=group3_option='<option value="">---</option>',$.each(e.group1,function(e,a){t+='<option value="'+a.id+'">'+a.group_name+"</option>",a.id,a.group_name}),$.each(e.group2,function(e,a){group2_option+='<option value="'+a.id+'">'+a.group_name+"</option>",a.id,a.group_name}),$.each(e.group3,function(e,a){group3_option+='<option value="'+a.id+'">'+a.group_name+"</option>",a.id,a.group_name}),$("#group_add_btn").addClass("disabled"),a="",a=(a=(a=(a=(a+='<tr style="font-size:9px;background:#fffae7" class="group_history_new">')+'<input type="hidden" name="group_history_id_'+f+'" value="new" class="group_history_new"><td><i class="fas fa-calendar-alt"></i>&nbsp;<input class="field_page_02 group-pickr pickr_'+f+'" type="text" value="'+n+'"></td>')+'<td id="group_end_'+f+'">現在</td><td><select name="group1_'+f+'" class="field_page_02">'+t+"</select></td>")+'<td><select name="group2_'+f+'" class="field_page_02">'+group2_option+"</select></td>")+'<td><select name="group3_'+f+'" class="field_page_02">'+group3_option+'</select></td><td class="group-btn-area"><div class="btn red group-history-del" data-group-history-id="new">削除</div></td></tr>',$("#group_body").prepend(a),g[f]=flatpickr(".pickr_"+f,{dateFormat:"Y年m月d日",onChange:function(e,a,t){e=new Date(e);e.setDate(e.getDate()-1),$("#group_end_0").text(h(new Date(e),"YYYY年MM月DD日")),g[0].set("maxDate",h(new Date(e),"YYYY-MM-DD"))}}),(n=new Date).setDate(n.getDate()-1),$("#group_end_0").text(h(new Date(n),"YYYY年MM月DD日")),(a=new Date(e.group_history[0].to_date)).setDate(a.getDate()+1),g[f].set("minDate",h(new Date(a),"YYYY-MM-DD")),f++)},renderTableColumns:new Promise(function(a,e){D().done(function(e){i=new Tabulator("#user_notice_table",{layout:"fitColumns",height:"calc(100vh - 405px)",columnMinWidth:20,columns:e,dataFiltered:function(e,a){var t=[];if(0<a.length){for(var n=0;n<a.length;n++)t.push(a[n]._row.data);b(t)}},dataEdited:function(e){b(e)},invalidOptionWarnings:!1}),a()})}),renderTableData:function(){i.replaceData("../../data/admin_user_detail/table_notice_data",{user_id:u},"POST")}};$(function(){function e(t){$.ajax({url:"../data/admin_user_detail/user_id_check",type:"POST",data:{user_id:t}}).done(function(e){var a;error__message=e?"この従業員IDは既に使用されてます":isNaN(t)?"従業員IDは数字で入力して下さい":null,e=error__message,a=n,$(".error-message").remove(),e&&(a.after(`<span class="error-message">${e}<span>`),$("#submit_page_01").addClass("disabled"))})}T.renderTab(s),$(".tab").on("click",function(){s=$(this).attr("id").substr(-2),T.renderTab(s),Cookies.set("userDetailTabKey",s),"04"===s&&T.renderTableData()}),datepicker1=flatpickr("#entry_date",{dateFormat:"Y-m-d"}),datepicker2=flatpickr("#resign_date",{dateFormat:"Y-m-d"}),datepicker3=flatpickr("#birth_date",{dateFormat:"Y-m-d",defaultDate:"1990-01-01",onChange:function(e,a){a&&$("#old").text(v(a)+"歳")}}),$("#modal_group").iziModal({headerColor:"#1591a2",focusInput:!1}),"new"!==u&&$(".user-del-btn").show(),0===mypage_flag&&($("#user_password_area").hide(),$("#tab_04").hide()),Promise.all([T.renderTableColumns]).then(function(){T.renderTableData()}),"new"!==u?(r="edit",$('input[name="user_id"]').addClass("disabled"),$('input[name="user_id"]').prop("disabled",!0),$("#mark").addClass("edit"),$("#mark").text("編集"),$("#password_label_text").text("パスワード （変更する場合のみ記入）"),d().done(function(e){T.renderUserDataForm(e),T.renderUserData()})):(r="new",$('input[name="user_id"]').removeClass("disabled"),$('input[name="user_id"]').prop("disabled",!1),$("#resign_date_area, #resign_btn, #tab_02, #tab_03, #tab_04, #tab_05").hide(),$("#mark").removeClass("edit"),$("#mark").text("新規"),$("#password_label_text").text("パスワード （入力をしない場合は従業員IDとなります）"),p().done(function(e){T.renderUserDataForm(e),T.renderUserData(),1===user_id_define&&$.ajax({url:"../../data/admin_user_detail/getNextUserId",dataType:"json"}).done(function(e){e=Number(e.maxUserID)+1;$("#input__user_id").val(e).css("color","#1591a2")})}));const n=$('input[name="user_id"]'),a=(n.on("input change",function(){e($(this).val())}),$('input[name="name_sei"]')),t=$('input[name="name_mei"]');$(".field_page_01").on("input change",function(){n.val()&&a.val()&&t.val()&&($("#submit_page_01").removeClass("disabled"),"new"===r&&e(n.val())),T.renderUserData()}),$('[name="state"]').on("click",function(){"new"!==u&&$("#resign_date_area").toggle()}),$("#submit_page_01").on("click",function(){$("#submit_page_01").addClass("disabled"),l().done(function(e){switch(e.message){case"ok_edit":siiimpleToast.message("修正登録完了",{position:"top|right"});break;case"ok_create":siiimpleToast.message("新規登録完了",{position:"top|right"}),Cookies.set("userDetailUserId",parseInt($("#user_id").text())),Cookies.set("userDetailTabKey","02");break;case"err_update":siiimpleToast.alert("修正登録エラー",{position:"top|right"});break;case"err_insert":siiimpleToast.alert("登録エラー",{position:"top|right"});break;case"err_ip":siiimpleToast.alert("従業員ID重複エラー",{position:"top|right"});break;default:siiimpleToast.alert("通信エラー",{position:"top|right"})}setTimeout("location.reload()",3e3)})}),$(document).delegate(".field_page_02","change",function(){$("#submit_page_02").removeClass("disabled")}),$(document).delegate("#group_add_btn","click",function(){d().done(function(e){T.addGroup(e)})}),$(document).delegate("#submit_page_02","click",function(){_().done(function(e){"ok"===e.message?siiimpleToast.message("登録完了",{position:"top|right"}):siiimpleToast.alert("登録エラー",{position:"top|right"}),setTimeout("location.reload()",3e3)})}),$(document).delegate(".group-history-del","click",function(){"new"===$(this).attr("data-group-history-id")?(f--,$(".group_history_new").remove(),$("#group_add_btn").removeClass("disabled"),$("#group_end_0").text("現在")):confirm("グループ履歴を削除します")&&m($(this).attr("data-group-history-id")).done(function(e){"ok_del"==e.message?location.reload():siiimpleToast.alert("エラー",{position:"top|right"})}).fail(function(){siiimpleToast.alert("エラー",{position:"top|right"})})}),$(document).delegate("#submit_page_03","click",function(){c().done(function(e){switch(e.message){case"ok_edit":siiimpleToast.message("修正登録完了",{position:"top|right"});break;case"err_update":siiimpleToast.message("修正登録エラー",{position:"top|right"});break;default:siiimpleToast.alert("通信エラー",{position:"top|right"})}setTimeout("location.reload()",3e3)})}),$(document).delegate("#submit_page_04","click",function(){"new"!==u&&($("#submit_page_04").addClass("disabled"),k().done(function(e){"ok"===e.message?siiimpleToast.message("登録完了",{position:"top|right"}):siiimpleToast.alert("登録エラー",{position:"top|right"}),setTimeout("location.reload()",3e3)}))}),$(document).delegate("#all_notice","click",function(){var t=[];$.each(o,function(e,a){obj={id:a.id,user_id:a.user_id,user_name:a.user_name,group1_name:a.group1_name,group2_name:a.group2_name,group3_name:a.group3_name,notice:!0,permit:a.permit},t.push(obj)}),i.replaceData(t)}),$(document).delegate("#all_none_notice","click",function(){var t=[];$.each(o,function(e,a){obj={id:a.id,user_id:a.user_id,user_name:a.user_name,group1_name:a.group1_name,group2_name:a.group2_name,group3_name:a.group3_name,notice:!1,permit:a.permit},t.push(obj)}),i.replaceData(t)}),$(document).delegate("#all_permit","click",function(){var t=[];$.each(o,function(e,a){obj={id:a.id,user_id:a.user_id,user_name:a.user_name,group1_name:a.group1_name,group2_name:a.group2_name,group3_name:a.group3_name,notice:a.notice,permit:!0},t.push(obj)}),i.replaceData(t)}),$(document).delegate("#all_none_permit","click",function(){var t=[];$.each(o,function(e,a){obj={id:a.id,user_id:a.user_id,user_name:a.user_name,group1_name:a.group1_name,group2_name:a.group2_name,group3_name:a.group3_name,notice:a.notice,permit:!1},t.push(obj)}),i.replaceData(t)}),$(document).delegate("#submit_page_05","click",function(){Y().done(function(e){"ok"===e.message?siiimpleToast.message("登録完了",{position:"top|right"}):siiimpleToast.alert("登録エラー",{position:"top|right"})})}),$(document).delegate("#submit_page_99","click",function(){$("#submit_page_99").addClass("disabled"),y().done(function(e){"ok"===e.message?siiimpleToast.message("削除しました",{position:"top|right"}):siiimpleToast.alert("削除エラー",{position:"top|right"}),Cookies.set("userDetailUserId","new"),Cookies.set("userDetailTabKey","01"),setTimeout("location.replace('/admin_users')",3e3)})})})}();
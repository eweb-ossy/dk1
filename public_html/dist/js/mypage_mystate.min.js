!function(){function l(e,t){if((t=(t=(t=(t=(t=(t=t.replace(/YYYY/g,e.getFullYear())).replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+e.getDate()).slice(-2))).replace(/hh/g,("0"+e.getHours()).slice(-2))).replace(/mm/g,("0"+e.getMinutes()).slice(-2))).replace(/ss/g,("0"+e.getSeconds()).slice(-2))).match(/S/g))for(var a=("00"+e.getMilliseconds()).slice(-3),o=t.match(/S/g).length,l=0;l<o;l++)t=t.replace(/S/,a.substring(l,l+1));return t}function e(e,t,a){switch(a){case"YYYY":e.setYear(e.getYear()+t);break;case"MM":e.setMonth(e.getMonth()+t);break;case"hh":e.setHours(e.getHours()+t);break;case"mm":e.setMinutes(e.getMinutes()+t);break;case"ss":e.setSeconds(e.getSeconds()+t);break;default:e.setDate(e.getDate()+t)}return e}var a,r,u,_,t=0,o=new Date,n=[],s={},i=function(){return $.ajax({url:"../../data/columns/lists",dataType:"json",type:"POST"})},d=function(e){(n=[]).all_count=e.length,n.all_work_data=e.filter(function(e){return 0<e.work_hour2}),n.all_work_hour=n.all_work_data.reduce(function(e,t){return e+Number(t.work_hour2)},0),0<n.all_work_hour&&(n.all_work_hour_w=Math.floor(n.all_work_hour/60)+":"+("0"+n.all_work_hour%60).slice(-2)),0<n.all_normal_hour&&(n.all_normal_hour_w=Math.floor(n.all_normal_hour/60)+":"+("0"+n.all_normal_hour%60).slice(-2)),n.all_shift_work_data=e.filter(function(e){return 0<e.shift_hour2}),n.all_shift_hour=n.all_shift_work_data.reduce(function(e,t){return e+Number(t.shift_hour2)},0),0<n.all_shift_hour&&(n.all_shift_hour_w=Math.floor(n.all_shift_hour/60)+":"+("0"+n.all_shift_hour%60).slice(-2)),n.all_rest_data=e.filter(function(e){return 0<e.rest_hour2}),n.all_rest_hour=n.all_rest_data.reduce(function(e,t){return e+Number(t.rest_hour2)},0),0<n.all_rest_hour&&(n.all_rest_hour_w=Math.floor(n.all_rest_hour/60)+":"+("0"+n.all_rest_hour%60).slice(-2)),n.all_over_data=e.filter(function(e){return 0<e.over_hour2}),n.all_over_hour=n.all_over_data.reduce(function(e,t){return e+Number(t.over_hour2)},0),0<n.all_over_hour&&(n.all_over_hour_w=Math.floor(n.all_over_hour/60)+":"+("0"+n.all_over_hour%60).slice(-2)),n.all_night_data=e.filter(function(e){return 0<e.night_hour2}),n.all_night_hour=n.all_night_data.reduce(function(e,t){return e+Number(t.night_hour2)},0),0<n.all_night_hour&&(n.all_night_hour_w=Math.floor(n.all_night_hour/60)+":"+("0"+n.all_night_hour%60).slice(-2)),n.all_late_data=e.filter(function(e){return 0<e.late_hour2}),n.all_late_hour=n.all_late_data.reduce(function(e,t){return e+Number(t.late_hour2)},0),0<n.all_late_hour&&(n.all_late_hour_w=Math.floor(n.all_late_hour/60)+":"+("0"+n.all_late_hour%60).slice(-2)),n.all_left_data=e.filter(function(e){return 0<e.left_hour2}),n.all_left_hour=n.all_left_data.reduce(function(e,t){return e+Number(t.left_hour2)},0),0<n.all_left_hour&&(n.all_left_hour_w=Math.floor(n.all_left_hour/60)+":"+("0"+n.all_left_hour%60).slice(-2))},c=function(){return $.ajax({type:"POST",dataType:"json",url:"../../data/admin_list_day/save",data:{today:s.date,user_id:userId,in_time:$("#picker_in_time").val(),out_time:$("#picker_out_time").val(),rest:$("#rest_range").val(),memo:$("#memo").val(),area_id:$('select[name="place"] option:selected').attr("data-area-id"),flag:"mypage"}})},m=function(){var e={system_id:sysId,user_id:userId};socket.emit("notice_client_to_server",e),socket.on("notice_server_to_client",function(e){var i=0,u=0;$.each(e,function(e,t){if(t.user_id!=userId&&t.high_user_id.indexOf(String(userId))<0)return!0;0==t.notice_status&&i++,1==t.notice_status&&(t.user_id,userId),2==t.notice_status&&(t.user_id,userId,u++),t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.user_id!=userId&&(t.user_id,t.user_name);var a=new Date(t.to_date),o=a.getFullYear(),l=a.getMonth()+1,r=a.getDate(),n=["日","月","火","水","木","金","土"][a.getDay()];("0"+l).slice(-2),("0"+r).slice(-2);t.end_date&&(o=(a=new Date(t.end_date)).getFullYear(),l=a.getMonth()+1,r=a.getDate(),n=["日","月","火","水","木","金","土"][a.getDay()],("0"+l).slice(-2),("0"+r).slice(-2))}),$("#notice_count_new, .badge-text1").hide(),$("#notice_count_ng, .badge-text2").hide(),0<i&&($("#notice_count_new, .badge-text1").show(),$("#notice_count_new").text(i)),0<u&&($("#notice_count_ng, .badge-text2").show(),$("#notice_count_ng").text(u))})},h={renderDate:new Promise(function(e,t){r=flatpickr("#month",{plugins:[new monthSelectPlugin({dateFormat:"Y年m月",theme:"light"})],onChange:function(){o=r.selectedDates[0],h.renderTableData(),h.renderDateText(o)}}),e()}),renderDateText:function(e){r.setDate(e),o=0<mypage_end_day?((o=new Date(e)).setMonth(o.getMonth()-1),t=mypage_end_day+1,t=l(o,"YYYY年MM月")+t+"日",a=l(e,"YYYY年MM月")+mypage_end_day+"日",new Date(o.getFullYear(),o.getMonth()+1,0).getDate()-mypage_end_day+mypage_end_day):(t=l(new Date(e),"YYYY年MM月")+"01日",a=l(new Date(e.getFullYear(),e.getMonth()+1,0),"YYYY年MM月DD日"),new Date(e.getFullYear(),e.getMonth()+1,0).getDate()),$("#to_from_date").text(t+"から"+a+"までの"+o+"日間");var t=new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{era:"long",year:"numeric"}).format(new Date(e)),a=($("#date-area-wareki").text(t),new Date),o=a.getFullYear(),t=a.getMonth(),a=new Date(e),e=a.getFullYear(),a=a.getMonth(),o=new Date(o,t),t=new Date(e,a),e=o.getMonth()-t.getMonth()+12*(o.getFullYear()-t.getFullYear());0==e?($("#this_month").addClass("disable"),$("#this_month_mark").addClass("this-month"),$("#this_month_mark").text("今月")):($("#this_month").removeClass("disable"),$("#this_month_mark").removeClass("this-month"),0<e?$("#this_month_mark").text(e+"ヶ月前"):$("#this_month_mark").text(Math.abs(e)+"ヶ月後"))},renderTableColumns:new Promise(function(t,e){i().done(function(e){a=new Tabulator("#data_table",{layout:"fitColumns",height:"calc(100vh - 142px)",columnMinWidth:20,columns:e,tooltips:function(e){var t=e.getColumn(),t=("in_work_time"!=t._column.field&&"out_work_time"!=t._column.field&&"work_hour"!=t._column.field&&"work_minute"!=t._column.field&&"rest_hour"!=t._column.field&&"rest_minute"!=t._column.field&&"status"!=t._column.field||(e.getElement().style.color="#1591a2"),"over_hour"!=t._column.field&&"over_minute"!=t._column.field&&"night_hour"!=t._column.field&&"night_minute"!=t._column.field&&"late_hour"!=t._column.field&&"late_minute"!=t._column.field&&"left_hour"!=t._column.field&&"left_minute"!=t._column.field||(e.getElement().style.color="#ff4560"),"normal_hour"!=t._column.field&&"normal_minute"!=t._column.field||(e.getElement().style.color="#673AB7"),"shift_in_time"!=t._column.field&&"shift_out_time"!=t._column.field&&"shift_hour"!=t._column.field||(e.getElement().style.color="#9abcea"),e.getValue());"日"!=t&&"祝"!=t||(e.getElement().style.color="#F44336"),"土"==t&&(e.getElement().style.color="#0D47A1"),"片打刻"==t&&(e.getElement().style.color="#ff4560"),"未出勤"==t&&(e.getElement().style.color="#673ab7"),"出勤"==t&&(e.getElement().style.color="#9abcea"),"公休"==t&&(e.getElement().style.color="#F44336"),"有給"!=t&&"有給取得"!=t||(e.getElement().style.color="#fff",e.getElement().style.background="#40a598"),"欠勤"==t&&(e.getElement().style.color="#fff",e.getElement().style.background="#fd6b80")},dataFiltered:function(e,t){var a=[];if(0<t.length){for(var o=0;o<t.length;o++)a.push(t[o]._row.data);d(a),h.renderListData()}},dataSorted:function(e,t){var a=[];if(0<t.length){for(var o=0;o<t.length;o++)a.push(t[o]._row.data);d(a),h.renderListData()}},rowClick:function(e,t){0!==mypage_self_edit_flag&&0!==mypage_self&&(s=t.getData(),h.render_modal(s))},invalidOptionWarnings:!1}),t(),a.hideColumn("work_hour2"),a.hideColumn("rest_hour2"),a.hideColumn("over_hour2"),a.hideColumn("night_hour2"),a.hideColumn("late_hour2"),a.hideColumn("left_hour2"),a.hideColumn("today_flag"),a.hideColumn("in_latitude"),a.hideColumn("in_longitude"),a.hideColumn("out_latitude"),a.hideColumn("out_longitude"),a.hideColumn("normal_hour2"),a.hideColumn("shift_hour2"),a.hideColumn("shift_rest"),a.hideColumn("area_id"),a.hideColumn("date")})}),renderTableData:function(){a.clearData(),a.replaceData("../../data/admin_lists/table_data",{year:l(new Date(o),"YYYY"),month:l(new Date(o),"MM"),user_id:userId,end_day:mypage_end_day},"POST")},renderListData:function(){setTimeout(function(){$('.tabulator-calcs-top > [tabulator-field="shift_hour"]').text(n.all_shift_hour_w),$('.tabulator-calcs-top > [tabulator-field="work_hour"]').text(n.all_work_hour_w),$('.tabulator-calcs-top > [tabulator-field="rest_hour"]').text(n.all_rest_hour_w),$('.tabulator-calcs-top > [tabulator-field="over_hour"]').text(n.all_over_hour_w),$('.tabulator-calcs-top > [tabulator-field="night_hour"]').text(n.all_night_hour_w),$('.tabulator-calcs-top > [tabulator-field="late_hour"]').text(n.all_late_hour_w),$('.tabulator-calcs-top > [tabulator-field="left_hour"]').text(n.all_left_hour_w),$('.tabulator-calcs-top > [tabulator-field="normal_hour"]').text(n.all_normal_hour_w)},100)},render_modal:function(e){$("#shift_view_btn").hide(),$("#modal_date").text($("#month").val()+("0"+e.day).slice(-2)+"日("+e.week+")");var t=e.in_work_time||"",t=(u=flatpickr("#picker_in_time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,defaultHour:defaultInHour,defaultMinute:defaultInMinute,minuteIncrement:defaultMinuteIncrement,defaultDate:t,onChange:function(){h.render_modal_check()},onClose:function(){h.render_modal_check()}}),_=flatpickr("#picker_out_time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,defaultHour:defaultOutHour,defaultMinute:defaultOutMinute,minuteIncrement:defaultMinuteIncrement,defaultDate:e.out_work_time,onChange:function(){h.render_modal_check()},onClose:function(){h.render_modal_check()}}),e.in_work_time||"--"),t=($("#in_time").text(t),e.out_work_time||"--"),t=($("#out_time").text(t),e.work_hour2?e.work_hour2+"分":"--"),t=($("#work_value").text(t),e.work_hour||""),t=($("#work_value2").text(t),$("#rest_range").prop("disabled",!1).val(Number(e.rest_hour2)),e.rest_hour2||0),t=(h.render_rest_btn(t),e.rest_hour||"0:00"),t=($("#rest_value2").text(t),(e.area?$('[name="place"] > option[value="'+e.area+'"]'):$('[name="place"] > option[value=""]')).prop("selected",!0),$("#memo").val(e.memo),$("#group1_name").text()),a=$("#group2_name").text(),o=$("#group3_name").text();$(".iziModal-header-title").text($(".sideber-username").text()),$(".iziModal-header-subtitle").text("ID："+userId+"　"+t+"　"+a+"　"+o),e.in_latitude&&e.in_longitude?$("#map_in").html('<iframe src="https://maps.google.co.jp/maps?output=embed&t=m&hl=ja&z=15&ll='+e.in_latitude+","+e.in_longitude+"&q="+e.in_latitude+","+e.in_longitude+'" frameborder="0" scrolling="no" width="323px" height="78px"></iframe>'):$("#map_in").html(""),e.out_latitude&&e.out_longitude?$("#map_out").html('<iframe src="https://maps.google.co.jp/maps?output=embed&t=m&hl=ja&z=15&ll='+e.out_latitude+","+e.out_longitude+"&q="+e.out_latitude+","+e.out_longitude+'" frameborder="0" scrolling="no" width="323px" height="78px"></iframe>'):$("#map_out").html(""),$("#time_edit_submit").attr("data-user-id",userId),$("#time_edit_submit").addClass("disable"),$("#modal2").iziModal("open")},render_rest_btn:function(e){$(".r_btn").removeClass("active"),$("#rest_"+e).addClass("active"),$("#memori_"+e).addClass("active"),$("#rest_value").text(e+"分");var t=e/60,a=Math.floor(t),t=Math.round(60*(t-a));$("#rest_value2").text(a+":"+("0"+t).slice(-2)),$("#rest_range").val(e),h.render_modal_check()},render_modal_check:function(){$("#time_edit_submit").addClass("disable"),$(".time-input, .rest-value, .shift-rest-value").removeClass("error"),$("#work_value, #shift_value").text("--"),$("#work_value2, #shift_value2").text("");var e=new Date(u.selectedDates).getHours(),t=60*e+new Date(u.selectedDates).getMinutes(),a=new Date(_.selectedDates).getHours(),o=60*a+new Date(_.selectedDates).getMinutes(),l=$("#picker_in_time").val(),r=$("#picker_out_time").val(),e=(0<over_day&&(e<=over_day&&(t+=1440,n=l.substr(0,2),i=l.substr(-2),l=(n=Number(n)+24)+":"+i),a<=over_day&&(o+=1440,n=r.substr(0,2),i=r.substr(-2),r=(n=Number(n)+24)+":"+i)),$("#rest_range").val());if(!t&&!o&&0<e)$(".rest-value").addClass("error");else if(t&&!o&&0<e)$(".rest-value").addClass("error");else if(!t&&o||!t&&0===o)$("#picker_in_time").addClass("error"),0<e&&$(".rest-value").addClass("error");else{if(t&&o){a=o-t;if(a-e<=0)return void $("#picker_out_time").addClass("error");if(a<=e)return void $(".rest-value").addClass("error");a-=e,$("#work_value").text(a+"分");var n=a/60,i=Math.floor(n),o=Math.round(60*(n-i));$("#work_value2").text(i+":"+("0"+o).slice(-2))}s.in_work_time!=l&&$("#time_edit_submit").removeClass("disable"),s.out_work_time!=r&&$("#time_edit_submit").removeClass("disable");(s.rest_hour2||0)!=e&&$("#time_edit_submit").removeClass("disable");t=$('select[name="place"] option:selected').attr("data-area-id"),a=(s.area_id!=t&&$("#time_edit_submit").removeClass("disable"),$("#memo").val());s.memo!=a&&$("#time_edit_submit").removeClass("disable")}},show_toast:function(e){siiimpleToast.message(e,{position:"top|right"})},show_err_toast:function(e){siiimpleToast.alert(e,{position:"top|right"})}};$(function(){m(),$(document).on("click",".navbar-toggler",function(){var e;t=1===t?($("html").removeClass("nav-open"),$(".close-layer").remove(),setTimeout(function(){$(this).removeClass("toggled")},400),0):(setTimeout(function(){$(this).addClass("toggled")},430),e=$('<div class="close-layer"></div>'),0!=$("body").find(".main-panel").length?e.appendTo(".main-panel"):$("body").hasClass("off-canvas-sidebar")&&e.appendTo(".wrapper-full-page"),setTimeout(function(){e.addClass("visible")},100),e.click(function(){$("html").removeClass("nav-open"),t=0,e.removeClass("visible"),setTimeout(function(){e.remove(),$(this).removeClass("toggled")},400)}),$("html").addClass("nav-open"),1)}),Promise.all([h.renderTableColumns,h.renderDate]).then(function(){h.renderDateText(o),h.renderTableData()}),$("#modal2").iziModal({headerColor:"#1591a2",focusInput:!1,width:700}),$(document).on("click","#less_month",function(){o=e(new Date(o),-1,"MM"),h.renderDateText(o),h.renderTableData()}),$(document).on("click","#add_month",function(){o=e(new Date(o),1,"MM"),h.renderDateText(o),h.renderTableData()}),$(document).on("click","#this_month_mark, #this_month",function(){(o=new Date).setDate(1),h.renderDateText(o),h.renderTableData()}),$(document).on("input","#rest_range",function(){var e=$(this).val();h.render_rest_btn(e)}),$(document).on("click",".r_btn",function(){var e=$(this).attr("data-time");h.render_rest_btn(e)}),$(document).on("input change",".time-val",function(){h.render_modal_check()}),$(document).on("click","#picker_del_in_time",function(){u.clear(),h.render_modal_check()}),$(document).on("click","#picker_del_out_time",function(){_.clear(),h.render_modal_check()}),$(document).on("click","#time_edit_submit",function(){$("#time_edit_submit").addClass("disable"),c().done(function(e){"ok"===e.message?($("#modal2").iziModal("close"),h.show_toast(e.today+" 修正登録 "+$("#user_name").text()+" "+e.user_id),h.renderTableData()):h.show_err_toast("通信エラー")}).fail(function(){h.show_err_toast("通信エラー")})}),$(document).on("click",".header-menu-btn",function(){$(this).next(".dropdown-menu").toggleClass("show")}),$(document).click(function(e){$(e.target).closest(".dropdown-menu").length||$(e.target).closest(".header-menu-btn").length||$(".dropdown-menu").removeClass("show")}),$(document).on("click",".dropdown-item",function(){Cookies.set("notice_id",$(this).attr("id")),location.href="/mypage_notice"})})}();
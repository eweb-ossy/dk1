!function(){function a(t,e){if((e=(e=(e=(e=(e=(e=e.replace(/YYYY/g,t.getFullYear())).replace(/MM/g,("0"+(t.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+t.getDate()).slice(-2))).replace(/hh/g,("0"+t.getHours()).slice(-2))).replace(/mm/g,("0"+t.getMinutes()).slice(-2))).replace(/ss/g,("0"+t.getSeconds()).slice(-2))).match(/S/g))for(var n=("00"+t.getMilliseconds()).slice(-3),o=e.match(/S/g).length,a=0;a<o;a++)e=e.replace(/S/,n.substring(a,a+1));return e}function t(t,e,n){switch(n){case"YYYY":t.setYear(t.getYear()+e);break;case"MM":t.setMonth(t.getMonth()+e);break;case"hh":t.setHours(t.getHours()+e);break;case"mm":t.setMinutes(t.getMinutes()+e);break;case"ss":t.setSeconds(t.getSeconds()+e);break;default:t.setDate(t.getDate()+e)}return t}var e,r,n,o,u,l={},i=new Date,c=(i.setDate(1),function(){return $.ajax({url:"../data/columns/list_user",dataType:"json",type:"POST"})}),_=function(){var t={system_id:sysId,user_id:userId};socket.emit("notice_client_to_server",t),socket.on("notice_server_to_client",function(t){var l=0,i=0;$.each(t,function(t,e){if(e.user_id!=userId&&e.high_user_id.indexOf(String(userId))<0)return!0;0==e.notice_status&&l++,1==e.notice_status&&(e.user_id,userId),2==e.notice_status&&(e.user_id,userId,i++),e.notice_flag,e.notice_flag,e.notice_flag,e.notice_flag,e.notice_flag,e.notice_flag,e.notice_flag,e.notice_flag,e.notice_flag,e.user_id!=userId&&(e.user_id,e.user_name);var n=new Date(e.to_date),o=n.getFullYear(),a=n.getMonth()+1,r=n.getDate(),u=["日","月","火","水","木","金","土"][n.getDay()];("0"+a).slice(-2),("0"+r).slice(-2);e.end_date&&(o=(n=new Date(e.end_date)).getFullYear(),a=n.getMonth()+1,r=n.getDate(),u=["日","月","火","水","木","金","土"][n.getDay()],("0"+a).slice(-2),("0"+r).slice(-2))}),$("#notice_count_new, .badge-text1").hide(),$("#notice_count_ng, .badge-text2").hide(),0<l&&($("#notice_count_new, .badge-text1").show(),$("#notice_count_new").text(l)),0<i&&($("#notice_count_ng, .badge-text2").show(),$("#notice_count_ng").text(i))})},s=function(t){var t="../../data/admin_download/"+t,e=document.createElement("form"),t=(e.setAttribute("action",t),e.setAttribute("method","post"),e.style.display="none",document.body.appendChild(e),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","column"),t.setAttribute("value",JSON.stringify(o)),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","dl_data"),t.setAttribute("value",JSON.stringify(u)),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","type"),t.setAttribute("value","list_user"),e.appendChild(t),document.createElement("input")),t=(t.setAttribute("type","hidden"),t.setAttribute("name","data_date"),t.setAttribute("value",a(new Date(i),"YYYY年MM月")),e.appendChild(t),document.createElement("input"));t.setAttribute("type","hidden"),t.setAttribute("name","all_data"),t.setAttribute("value",JSON.stringify(l)),e.appendChild(t),e.submit()},d=function(t){var e=t.filter(function(t){return 0<t.work_count}),e=(l.work_count=e.reduce(function(t,e){return t+Number(e.work_count)},0),t.filter(function(t){return 0<t.work_hour2})),e=(l.work_minute=e.reduce(function(t,e){return t+Number(e.work_hour2)},0),0<l.work_minute?l.work_hour=Math.floor(l.work_minute/60)+":"+("0"+l.work_minute%60).slice(-2):l.work_hour="",t.filter(function(t){return 0<t.normal_hour2})),e=(l.normal_minute=e.reduce(function(t,e){return t+Number(e.normal_hour2)},0),0<l.normal_minute?l.normal_hour=Math.floor(l.normal_minute/60)+":"+("0"+l.normal_minute%60).slice(-2):l.normal_hour="",t.filter(function(t){return 0<t.over_count})),e=(l.over_count=e.reduce(function(t,e){return t+Number(e.over_count)},0),t.filter(function(t){return 0<t.over_hour2})),e=(l.over_minute=e.reduce(function(t,e){return t+Number(e.over_hour2)},0),0<l.over_minute?l.over_hour=Math.floor(l.over_minute/60)+":"+("0"+l.over_minute%60).slice(-2):l.over_hour="",t.filter(function(t){return 0<t.night_count})),e=(l.night_count=e.reduce(function(t,e){return t+Number(e.night_count)},0),t.filter(function(t){return 0<t.night_hour2})),e=(l.night_minute=e.reduce(function(t,e){return t+Number(e.night_hour2)},0),0<l.night_minute?l.night_hour=Math.floor(l.night_minute/60)+":"+("0"+l.night_minute%60).slice(-2):l.night_hour="",t.filter(function(t){return 0<t.late_count})),e=(l.late_count=e.reduce(function(t,e){return t+Number(e.late_count)},0),t.filter(function(t){return 0<t.late_hour2})),e=(l.late_minute=e.reduce(function(t,e){return t+Number(e.late_hour2)},0),0<l.late_minute?l.late_hour=Math.floor(l.late_minute/60)+":"+("0"+l.late_minute%60).slice(-2):l.late_hour="",t.filter(function(t){return 0<t.left_count})),e=(l.left_count=e.reduce(function(t,e){return t+Number(e.left_count)},0),t.filter(function(t){return 0<t.left_hour2}));l.left_minute=e.reduce(function(t,e){return t+Number(e.left_hour2)},0),0<l.left_minute?l.left_hour=Math.floor(l.left_minute/60)+":"+("0"+l.left_minute%60).slice(-2):l.left_hour=""},m={renderDate:function(){(i=(r=flatpickr("#month",{plugins:[new monthSelectPlugin({dateFormat:"Y年m月",theme:"light"})],defaultDate:"today",onChange:function(){i=r.selectedDates[0],e.clearData(),m.renderTableData(),m.renderDateText(i)}})).selectedDates[0]).setDate(1)},renderDateText:function(t){r.setDate(t),o=0<mypage_end_day?((o=new Date(t)).setMonth(o.getMonth()-1),e=mypage_end_day+1,e=a(o,"YYYY年MM月")+e+"日",n=a(t,"YYYY年MM月")+mypage_end_day+"日",new Date(o.getFullYear(),o.getMonth()+1,0).getDate()-mypage_end_day+mypage_end_day):(e=a(new Date(t),"YYYY年MM月")+"01日",n=a(new Date(t.getFullYear(),t.getMonth()+1,0),"YYYY年MM月DD日"),new Date(t.getFullYear(),t.getMonth()+1,0).getDate()),$("#to_from_date").text(e+"から"+n+"までの"+o+"日間");var e=new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{era:"long",year:"numeric"}).format(new Date(t)),n=($("#date-area-wareki").text(e),new Date),o=n.getFullYear(),e=n.getMonth(),n=new Date(t),t=n.getFullYear(),n=n.getMonth(),o=new Date(o,e),e=new Date(t,n),t=o.getMonth()-e.getMonth()+12*(o.getFullYear()-e.getFullYear());0==t?($("#this_month").addClass("disable"),$("#this_month_mark").addClass("this-month"),$("#this_month_mark").text("今月")):($("#this_month").removeClass("disable"),$("#this_month_mark").removeClass("this-month"),0<t?$("#this_month_mark").text(t+"ヶ月前"):$("#this_month_mark").text(Math.abs(t)+"ヶ月後"))},renderTableColumns:function(){c().done(function(t){(o=t.filter(function(t){return t.output})).forEach(function(t,e){var n=0===e?"合計":"";t.field?l[t.field]=n:t.columns.forEach(function(t){l[t.field]=n})}),e=new Tabulator("#data_table",{height:"calc(100vh - 142px)",columns:t,tooltips:function(t){var e=t.getColumn();"work_count"!=e._column.field&&"work_hour"!=e._column.field&&"work_minute"!=e._column.field||(t.getElement().style.color="#1591a2"),"over_count"!=e._column.field&&"over_hour"!=e._column.field&&"over_minute"!=e._column.field&&"night_count"!=e._column.field&&"night_hour"!=e._column.field&&"night_minute"!=e._column.field&&"late_count"!=e._column.field&&"late_hour"!=e._column.field&&"late_minute"!=e._column.field&&"left_count"!=e._column.field&&"left_hour"!=e._column.field&&"left_minute"!=e._column.field||(t.getElement().style.color="#ff4560"),"normal_hour"!=e._column.field&&"normal_minute"!=e._column.field||(t.getElement().style.color="#673AB7")},dataFiltered:function(t,e){var n=[];if(0<e.length){for(var o=0;o<e.length;o++)n.push(e[o]._row.data);d(n),u=n,m.renderListData()}},dataSorted:function(t,e){var n=[];if(0<e.length){for(var o=0;o<e.length;o++)n.push(e[o]._row.data);d(n),u=n,m.renderListData()}},rowClick:function(t,e){(n=e.getData()).user_id&&(Cookies.set("MypagetoListsMonth",i),Cookies.set("MypagetoListsuserID",parseInt(n.user_id)),window.location.href="mypage_list")},invalidOptionWarnings:!1}),m.renderTableData()})},renderTableData:function(){e.replaceData("../data/admin_list_user/table_data",{year:a(new Date(i),"YYYY"),month:a(new Date(i),"MM"),end_day:mypage_end_day,user_id:userId},"POST"),e.hideColumn("work_hour2"),e.hideColumn("over_hour2"),e.hideColumn("night_hour2"),e.hideColumn("late_hour2"),e.hideColumn("left_hour2"),e.hideColumn("normal_hour2"),e.hideColumn("group1_name"),e.hideColumn("group2_name"),e.hideColumn("group3_name")},renderListData:function(){setTimeout(function(){$('.tabulator-calcs-top > [tabulator-field="work_hour"]').text(l.work_hour),$('.tabulator-calcs-top > [tabulator-field="work_minute"]').text(l.work_minute),$('.tabulator-calcs-top > [tabulator-field="rest_hour"]').text(l.rest_hour),$('.tabulator-calcs-top > [tabulator-field="rest_minute"]').text(l.rest_minute),$('.tabulator-calcs-top > [tabulator-field="over_hour"]').text(l.over_hour),$('.tabulator-calcs-top > [tabulator-field="over_minute"]').text(l.over_minute),$('.tabulator-calcs-top > [tabulator-field="night_hour"]').text(l.night_hour),$('.tabulator-calcs-top > [tabulator-field="night_minute"]').text(l.night_minute),$('.tabulator-calcs-top > [tabulator-field="late_hour"]').text(l.late_hour),$('.tabulator-calcs-top > [tabulator-field="late_minute"]').text(l.late_minute),$('.tabulator-calcs-top > [tabulator-field="left_hour"]').text(l.left_hour),$('.tabulator-calcs-top > [tabulator-field="left_minute"]').text(l.left_minute),$('.tabulator-calcs-top > [tabulator-field="normal_hour"]').text(l.normal_hour),$('.tabulator-calcs-top > [tabulator-field="normal_minute"]').text(l.normal_minute),$('.tabulator-calcs-top > [tabulator-field="work_count"]').text(l.work_count),$('.tabulator-calcs-top > [tabulator-field="over_count"]').text(l.over_count),$('.tabulator-calcs-top > [tabulator-field="night_count"]').text(l.night_count),$('.tabulator-calcs-top > [tabulator-field="late_count"]').text(l.late_count),$('.tabulator-calcs-top > [tabulator-field="left_count"]').text(l.left_count)},100)}};$(function(){_(),$(document).on("click",".navbar-toggler",function(){var t;mobile_menu_visible=1===mobile_menu_visible?($("html").removeClass("nav-open"),$(".close-layer").remove(),setTimeout(function(){$(this).removeClass("toggled")},400),0):(setTimeout(function(){$(this).addClass("toggled")},430),t=$('<div class="close-layer"></div>'),0!=$("body").find(".main-panel").length?t.appendTo(".main-panel"):$("body").hasClass("off-canvas-sidebar")&&t.appendTo(".wrapper-full-page"),setTimeout(function(){t.addClass("visible")},100),t.click(function(){$("html").removeClass("nav-open"),mobile_menu_visible=0,t.removeClass("visible"),setTimeout(function(){t.remove(),$(this).removeClass("toggled")},400)}),$("html").addClass("nav-open"),1)}),m.renderDate(),m.renderDateText(i),m.renderTableColumns(),$(document).delegate("#less_month","click",function(){i=t(new Date(i),-1,"MM"),e.clearData(),m.renderTableData(),m.renderDateText(i)}),$(document).delegate("#add_month","click",function(){i=t(new Date(i),1,"MM"),e.clearData(),m.renderTableData(),m.renderDateText(i)}),$(document).delegate("#this_month_mark, #this_month","click",function(){(i=new Date).setDate(1),e.clearData(),m.renderTableData(),m.renderDateText(i)}),$("#table_window_btn").on("click",function(){$(this).toggleClass("on"),e.toggleColumn("group1_name"),e.toggleColumn("group2_name"),e.toggleColumn("group3_name")}),$(document).on("click",".header-menu-btn",function(){$(this).next(".dropdown-menu").toggleClass("show")}),$(document).click(function(t){$(t.target).closest(".dropdown-menu").length||$(t.target).closest(".header-menu-btn").length||$(".dropdown-menu").removeClass("show")}),$(document).on("click",".dropdown-item",function(){Cookies.set("notice_id",$(this).attr("id")),location.href="/mypage_notice"}),$("#download_btn_excel").on("click",function(){s("xlsx")}),$("#download_btn_pdf").on("click",function(){s("pdf")})})}();
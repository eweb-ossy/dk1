!function(){function l(e,t){if((t=(t=(t=(t=(t=(t=t.replace(/YYYY/g,e.getFullYear())).replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+e.getDate()).slice(-2))).replace(/hh/g,("0"+e.getHours()).slice(-2))).replace(/mm/g,("0"+e.getMinutes()).slice(-2))).replace(/ss/g,("0"+e.getSeconds()).slice(-2))).match(/S/g))for(var n=("00"+e.getMilliseconds()).slice(-3),a=t.match(/S/g).length,o=0;o<a;o++)t=t.replace(/S/,n.substring(o,o+1));return t}var t,r,n,o,a;const i={getTableColumns:function(){return $.ajax({url:"../data/columns/list_month",dataType:"json",type:"POST",data:{year:l(new Date(a),"YYYY"),month:l(new Date(a),"MM"),end_day:end_day}})},getGraphData:function(){return $.ajax({url:"../data/list_month/graph_data",dataType:"json",type:"POST",data:{year:l(new Date(a),"YYYY"),month:l(new Date(a),"MM")}})},downloadData:function(e){var e="../../data/admin_download/"+e,t=document.createElement("form"),e=(t.setAttribute("action",e),t.setAttribute("method","post"),t.style.display="none",document.body.appendChild(t),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","column"),e.setAttribute("value",JSON.stringify(n)),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","dl_data"),e.setAttribute("value",JSON.stringify(o)),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","type"),e.setAttribute("value","month"),t.appendChild(e),document.createElement("input"));e.setAttribute("type","hidden"),e.setAttribute("name","data_date"),e.setAttribute("value",l(new Date(a),"YYYY年MM月")),t.appendChild(e),t.submit()}},u={renderDate:function(){(a=(r=flatpickr("#month",{plugins:[new monthSelectPlugin({dateFormat:"Y年m月",theme:"light"})],defaultDate:"today",onChange:function(){a=r.selectedDates[0],t.clearData(),i.getTableColumns().done(function(e){n=e.filter(function(e){return e.output}),t.setColumns(e),u.renderTableColumns(),u.renderDateText(a)})}})).selectedDates[0]).setDate(1),Cookies.get("listMonth")&&(a=new Date(Cookies.get("listMonth")),u.renderDateText(a))},renderDateText:function(e){r.setDate(e),a=0<end_day?((a=new Date(e)).setMonth(a.getMonth()-1),t=end_day+1,t=l(a,"YYYY年MM月")+t+"日",n=l(e,"YYYY年MM月")+end_day+"日",new Date(a.getFullYear(),a.getMonth()+1,0).getDate()-end_day+end_day):(t=l(new Date(e),"YYYY年MM月")+"01日",n=l(new Date(e.getFullYear(),e.getMonth()+1,0),"YYYY年MM月DD日"),new Date(e.getFullYear(),e.getMonth()+1,0).getDate()),$("#to_from_date").text(t+"から"+n+"までの"+a+"日間");var t=new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{era:"long",year:"numeric"}).format(new Date(e)),n=($("#date-area-wareki").text(t),new Date),a=n.getFullYear(),t=n.getMonth(),n=new Date(e),o=n.getFullYear(),n=n.getMonth(),a=new Date(a,t),t=new Date(o,n),o=a.getMonth()-t.getMonth()+12*(a.getFullYear()-t.getFullYear());0==o?($("#this_month").addClass("disable"),$("#this_month_mark").addClass("this-month"),$("#this_month_mark").text("今月")):($("#this_month").removeClass("disable"),$("#this_month_mark").removeClass("this-month"),0<o?$("#this_month_mark").text(o+"ヶ月前"):$("#this_month_mark").text(Math.abs(o)+"ヶ月後")),Cookies.set("listMonth",e)},renderTableColumns:function(){i.getTableColumns().done(function(e){n=e.filter(function(e){return e.output}),t=new Tabulator("#data_table",{height:"calc(100vh - 262px)",layout:"fitDataStretch",columns:e,tooltips:function(e){var t=e.getColumn();e.getValue()&&"user_id"!==t._column.field&&"user_name"!==t._column.field&&"group1_name"!==t._column.field&&"group2_name"!==t._column.field&&"group3_name"!==t._column.field&&(e.getElement().style.backgroundColor="rgba(199, 249, 222, 0.7)"),1<=t._column.field&&t._column.field<=31&&(e.getElement().style.color="#1591a2"),"sum"!=t._column.field&&"time"!=t._column.field||(e.getElement().style.color="#1591a2",e.getElement().style.backgroundColor="rgba(244, 244, 244, 0.5)",e.getElement().style.fontWeight="bold")},dataFiltered:function(e,t){var n=[];if(0<t.length){for(var a=0;a<t.length;a++)n.push(t[a]._row.data);o=n}},dataSorted:function(e,t){var n=[];if(0<t.length){for(var a=0;a<t.length;a++)n.push(t[a]._row.data);o=n}},rowClick:function(e,t){t=t.getData();t.user_id&&(Cookies.set("toListsMonth",a),Cookies.set("toListsuserID",parseInt(t.user_id)),window.location.href="admin_lists")},invalidOptionWarnings:!1}),u.renderTableData()})},renderTableData:function(){t.replaceData("../data/admin_list_month/table_data",{year:l(new Date(a),"YYYY"),month:l(new Date(a),"MM")},"POST"),t.hideColumn("group1_name"),t.hideColumn("group2_name"),t.hideColumn("group3_name")}};$(function(){function e(e){a=e?new Date(a.setMonth(a.getMonth()+e)):new Date,t.clearData(),i.getTableColumns().done(e=>{n=e.filter(function(e){return e.output}),t.setColumns(e),u.renderTableColumns(),u.renderDateText(a)})}u.renderDate(),u.renderDateText(a),u.renderTableColumns(),$("#less_month").on("click",function(){e(-1)}),$("#add_month").on("click",function(){e(1)}),$("#this_month_mark, #this_month").on("click",function(){e()}),$("#table_window_btn").on("click",function(){$(this).toggleClass("on"),t.toggleColumn("group1_name"),t.toggleColumn("group2_name"),t.toggleColumn("group3_name")}),$("#download_btn_excel").on("click",function(){i.downloadData("xlsx")}),$("#download_btn_pdf").on("click",function(){i.downloadData("pdf")})})}();
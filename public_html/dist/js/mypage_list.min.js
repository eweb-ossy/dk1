!function(){function o(e,t){if((t=(t=(t=(t=(t=(t=t.replace(/YYYY/g,e.getFullYear())).replace(/MM/g,("0"+(e.getMonth()+1)).slice(-2))).replace(/DD/g,("0"+e.getDate()).slice(-2))).replace(/hh/g,("0"+e.getHours()).slice(-2))).replace(/mm/g,("0"+e.getMinutes()).slice(-2))).replace(/ss/g,("0"+e.getSeconds()).slice(-2))).match(/S/g))for(var a=("00"+e.getMilliseconds()).slice(-3),n=t.match(/S/g).length,o=0;o<n;o++)t=t.replace(/S/,a.substring(o,o+1));return t}function e(e,t,a){switch(a){case"YYYY":e.setYear(e.getYear()+t);break;case"MM":e.setMonth(e.getMonth()+t);break;case"hh":e.setHours(e.getHours()+t);break;case"mm":e.setMinutes(e.getMinutes()+t);break;case"ss":e.setSeconds(e.getSeconds()+t);break;default:e.setDate(e.getDate()+t)}return e}var a,r,u,s,n,i,l,d,_={},m={},c=(Cookies.get("MypagetoListsuserID")?(l=Cookies.get("MypagetoListsuserID"),d=new Date(Cookies.get("MypagetoListsMonth"))):window.location.href="/",function(){return $.ajax({url:"../../data/columns/lists",dataType:"json",type:"POST"})}),t=function(){return $.ajax({url:"../../data/admin_lists/user_data",dataType:"json",type:"POST",data:{user_id:l,year:o(new Date(d),"YYYY"),month:o(new Date(d),"MM")}})},h=function(){var e={system_id:sysId,user_id:userId};socket.emit("notice_client_to_server",e),socket.on("notice_server_to_client",function(e){var l=0,u=0;$.each(e,function(e,t){if(t.user_id!=userId&&t.high_user_id.indexOf(String(userId))<0)return!0;0==t.notice_status&&l++,1==t.notice_status&&(t.user_id,userId),2==t.notice_status&&(t.user_id,userId,u++),t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.notice_flag,t.user_id!=userId&&(t.user_id,t.user_name);var a=new Date(t.to_date),n=a.getFullYear(),o=a.getMonth()+1,r=a.getDate(),i=["日","月","火","水","木","金","土"][a.getDay()];("0"+o).slice(-2),("0"+r).slice(-2);t.end_date&&(n=(a=new Date(t.end_date)).getFullYear(),o=a.getMonth()+1,r=a.getDate(),i=["日","月","火","水","木","金","土"][a.getDay()],("0"+o).slice(-2),("0"+r).slice(-2))}),$("#notice_count_new, .badge-text1").hide(),$("#notice_count_ng, .badge-text2").hide(),0<l&&($("#notice_count_new, .badge-text1").show(),$("#notice_count_new").text(l)),0<u&&($("#notice_count_ng, .badge-text2").show(),$("#notice_count_ng").text(u))})},f=function(e){var t=e.filter(function(e){return 0<e.work_hour2}),t=(_.work_minute=t.reduce(function(e,t){return e+Number(t.work_hour2)},0),_.work_hour=0<_.work_minute?Math.floor(_.work_minute/60)+":"+("0"+_.work_minute%60).slice(-2):"",e.filter(function(e){return 0<e.normal_hour2})),t=(_.normal_minute=t.reduce(function(e,t){return e+Number(t.normal_hour2)},0),_.normal_hour=0<_.normal_minute?Math.floor(_.normal_minute/60)+":"+("0"+_.normal_minute%60).slice(-2):"",e.filter(function(e){return 0<e.shift_hour2})),t=(_.shift_hour2=t.reduce(function(e,t){return e+Number(t.shift_hour2)},0),_.shift_hour=0<_.shift_hour2?Math.floor(_.shift_hour2/60)+":"+("0"+_.shift_hour2%60).slice(-2):"",e.filter(function(e){return 0<e.rest_hour2})),t=(_.rest_minute=t.reduce(function(e,t){return e+Number(t.rest_hour2)},0),_.rest_hour=0<_.rest_minute?Math.floor(_.rest_minute/60)+":"+("0"+_.rest_minute%60).slice(-2):"",e.filter(function(e){return 0<e.over_hour2})),t=(_.over_minute=t.reduce(function(e,t){return e+Number(t.over_hour2)},0),_.over_hour=0<_.over_minute?Math.floor(_.over_minute/60)+":"+("0"+_.over_minute%60).slice(-2):"",e.filter(function(e){return 0<e.night_hour2})),t=(_.night_minute=t.reduce(function(e,t){return e+Number(t.night_hour2)},0),_.night_hour=0<_.night_minute?Math.floor(_.night_minute/60)+":"+("0"+_.night_minute%60).slice(-2):"",e.filter(function(e){return 0<e.late_hour2})),t=(_.late_minute=t.reduce(function(e,t){return e+Number(t.late_hour2)},0),_.late_hour=0<_.late_minute?Math.floor(_.late_minute/60)+":"+("0"+_.late_minute%60).slice(-2):"",e.filter(function(e){return 0<e.left_hour2}));_.left_minute=t.reduce(function(e,t){return e+Number(t.left_hour2)},0),_.left_hour=0<_.left_minute?Math.floor(_.left_minute/60)+":"+("0"+_.left_minute%60).slice(-2):""},g=function(){return $.ajax({type:"POST",dataType:"json",url:"../../data/admin_list_day/save",data:{today:m.date,user_id:l,in_time:$("#picker_in_time").val(),out_time:$("#picker_out_time").val(),rest:$("#rest_range").val(),memo:$("#memo").val(),area_id:$('select[name="place"] option:selected').attr("data-area-id"),flag:"mypage"}})},p=function(e){var e="../../data/admin_download/"+e,t=document.createElement("form"),e=(t.setAttribute("action",e),t.setAttribute("method","post"),t.style.display="none",document.body.appendChild(t),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","column"),e.setAttribute("value",JSON.stringify(n)),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","dl_data"),e.setAttribute("value",JSON.stringify(i)),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","type"),e.setAttribute("value","user_detail"),t.appendChild(e),document.createElement("input")),e=(e.setAttribute("type","hidden"),e.setAttribute("name","data_date"),e.setAttribute("value",o(new Date(d),"YYYY年MM月")+" "+$("#user_name").text()+" "+$("#user_id").text()),t.appendChild(e),document.createElement("input"));e.setAttribute("type","hidden"),e.setAttribute("name","all_data"),e.setAttribute("value",JSON.stringify(_)),t.appendChild(e),t.submit()};function b(e){var t=[];if(0<e.length){for(var a=0;a<e.length;a++)t.push(e[a]._row.data);f(t),i=t}}var v={renderDate:new Promise(function(e,t){r=flatpickr("#month",{plugins:[new monthSelectPlugin({dateFormat:"Y年m月",theme:"light"})],onChange:function(){d=r.selectedDates[0],v.renderTableData(),v.renderDateText(d)}}),e()}),renderDateText:function(e){r.setDate(e),n=0<mypage_end_day?((n=new Date(e)).setMonth(n.getMonth()-1),t=mypage_end_day+1,t=o(n,"YYYY年MM月")+t+"日",a=o(e,"YYYY年MM月")+mypage_end_day+"日",new Date(n.getFullYear(),n.getMonth()+1,0).getDate()-mypage_end_day+mypage_end_day):(t=o(new Date(e),"YYYY年MM月")+"01日",a=o(new Date(e.getFullYear(),e.getMonth()+1,0),"YYYY年MM月DD日"),new Date(e.getFullYear(),e.getMonth()+1,0).getDate()),$("#to_from_date").text(t+"から"+a+"までの"+n+"日間");var t=new Intl.DateTimeFormat("ja-JP-u-ca-japanese",{era:"long",year:"numeric"}).format(new Date(e)),a=($("#date-area-wareki").text(t),new Date),n=a.getFullYear(),t=a.getMonth(),a=new Date(e),e=a.getFullYear(),a=a.getMonth(),n=new Date(n,t),t=new Date(e,a),e=n.getMonth()-t.getMonth()+12*(n.getFullYear()-t.getFullYear());0==e?($("#this_month").addClass("disable"),$("#this_month_mark").addClass("this-month"),$("#this_month_mark").text("今月")):($("#this_month").removeClass("disable"),$("#this_month_mark").removeClass("this-month"),0<e?$("#this_month_mark").text(e+"ヶ月前"):$("#this_month_mark").text(Math.abs(e)+"ヶ月後"))},renderTableColumns:new Promise(function(t,e){c().done(function(e){(n=e.filter(e=>e.output)).forEach((e,t)=>{let a=0===t?"合計":"";e.field?_[e.field]=a:e.columns.forEach(e=>{_[e.field]=a})}),a=new Tabulator("#data_table",{layout:"fitColumns",height:"calc(100vh - 142px)",columnMinWidth:20,columns:e,tooltips:function(e){var t=e.getColumn(),t=("in_work_time"!=t._column.field&&"out_work_time"!=t._column.field&&"work_hour"!=t._column.field&&"work_minute"!=t._column.field&&"rest_hour"!=t._column.field&&"rest_minute"!=t._column.field&&"status"!=t._column.field||(e.getElement().style.color="#1591a2"),"over_hour"!=t._column.field&&"over_minute"!=t._column.field&&"night_hour"!=t._column.field&&"night_minute"!=t._column.field&&"late_hour"!=t._column.field&&"late_minute"!=t._column.field&&"left_hour"!=t._column.field&&"left_minute"!=t._column.field||(e.getElement().style.color="#ff4560"),"normal_hour"!=t._column.field&&"normal_minute"!=t._column.field||(e.getElement().style.color="#673AB7"),"shift_in_time"!=t._column.field&&"shift_out_time"!=t._column.field&&"shift_hour"!=t._column.field||(e.getElement().style.color="#9abcea"),e.getValue());"日"!=t&&"祝"!=t||(e.getElement().style.color="#F44336"),"土"==t&&(e.getElement().style.color="#0D47A1"),"片打刻"==t&&(e.getElement().style.color="#ff4560"),"未出勤"==t&&(e.getElement().style.color="#673ab7"),"出勤"==t&&(e.getElement().style.color="#9abcea"),"公休"==t&&(e.getElement().style.color="#F44336"),"有給"!=t&&"有給取得"!=t||(e.getElement().style.color="#fff",e.getElement().style.background="#40a598"),"欠勤"==t&&(e.getElement().style.color="#fff",e.getElement().style.background="#fd6b80")},dataFiltered:function(e,t){var a=[];if(0<t.length){for(var n=0;n<t.length;n++)a.push(t[n]._row.data);f(a),v.renderListData()}b(t)},dataSorted:function(e,t){var a=[];if(0<t.length){for(var n=0;n<t.length;n++)a.push(t[n]._row.data);f(a),v.renderListData()}b(t)},rowClick:function(e,t){0!==edit_flag&&(m=t.getData()).day&&v.render_modal(m)},invalidOptionWarnings:!1}),t(),a.hideColumn("work_hour2"),a.hideColumn("rest_hour2"),a.hideColumn("over_hour2"),a.hideColumn("night_hour2"),a.hideColumn("late_hour2"),a.hideColumn("left_hour2"),a.hideColumn("today_flag"),a.hideColumn("in_latitude"),a.hideColumn("in_longitude"),a.hideColumn("out_latitude"),a.hideColumn("out_longitude"),a.hideColumn("normal_hour2"),a.hideColumn("shift_hour2"),a.hideColumn("shift_rest"),a.hideColumn("area_id"),a.hideColumn("date"),1===mypage_status_inout_view_flag&&(a.hideColumn("in_work_time"),a.hideColumn("out_work_time")),2===mypage_status_inout_view_flag&&(a.hideColumn("in_time"),a.hideColumn("out_time"))})}),renderTableData:function(){a.clearData(),a.replaceData("../../data/admin_lists/table_data",{year:o(new Date(d),"YYYY"),month:o(new Date(d),"MM"),user_id:l,end_day:mypage_end_day},"POST")},renderUserData:function(){t().done(function(e){$("#user_kana").text(e.user_kana),$("#user_name").text(e.user_name),$("#user_id").text(l),$("#group1_name").text(e.group1_name),$("#group2_name").text(e.group2_name),$("#group3_name").text(e.group3_name)})},render_modal:function(e){$("#shift_view_btn").hide(),$("#modal_date").text($("#month").val()+("0"+e.day).slice(-2)+"日("+e.week+")");var t=e.in_work_time||"",t=(u=flatpickr("#picker_in_time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,defaultHour:defaultInHour,defaultMinute:defaultInMinute,minuteIncrement:defaultMinuteIncrement,defaultDate:t,onChange:function(){v.render_modal_check()},onClose:function(){v.render_modal_check()}}),s=flatpickr("#picker_out_time",{enableTime:!0,noCalendar:!0,dateFormat:"H:i",time_24hr:!0,defaultHour:defaultOutHour,defaultMinute:defaultOutMinute,minuteIncrement:defaultMinuteIncrement,defaultDate:e.out_work_time,onChange:function(){v.render_modal_check()},onClose:function(){v.render_modal_check()}}),e.in_work_time||"--"),t=($("#in_time").text(t),e.out_work_time||"--"),t=($("#out_time").text(t),e.work_hour2?e.work_hour2+"分":"--"),t=($("#work_value").text(t),e.work_hour||""),t=($("#work_value2").text(t),$("#rest_range").prop("disabled",!1).val(Number(e.rest_hour2)),e.rest_hour2||0),t=(v.render_rest_btn(t),e.rest_hour||"0:00"),t=($("#rest_value2").text(t),(e.area?$('[name="place"] > option[value="'+e.area+'"]'):$('[name="place"] > option[value=""]')).prop("selected",!0),$("#memo").val(e.memo),$("#group1_name").text()),a=$("#group2_name").text(),n=$("#group3_name").text();$(".iziModal-header-title").text($("#user_name").text()),$(".iziModal-header-subtitle").text("ID："+l+"　"+t+"　"+a+"　"+n),e.in_latitude&&e.in_longitude?$("#map_in").html('<iframe src="https://maps.google.co.jp/maps?output=embed&t=m&hl=ja&z=15&ll='+e.in_latitude+","+e.in_longitude+"&q="+e.in_latitude+","+e.in_longitude+'" frameborder="0" scrolling="no" width="323px" height="78px"></iframe>'):$("#map_in").html(""),e.out_latitude&&e.out_longitude?$("#map_out").html('<iframe src="https://maps.google.co.jp/maps?output=embed&t=m&hl=ja&z=15&ll='+e.out_latitude+","+e.out_longitude+"&q="+e.out_latitude+","+e.out_longitude+'" frameborder="0" scrolling="no" width="323px" height="78px"></iframe>'):$("#map_out").html(""),$("#time_edit_submit").attr("data-user-id",l),$("#time_edit_submit").addClass("disable"),$("#modal2").iziModal("open")},render_rest_btn:function(e){$(".r_btn").removeClass("active"),$("#rest_"+e).addClass("active"),$("#memori_"+e).addClass("active"),$("#rest_value").text(e+"分");var t=e/60,a=Math.floor(t),t=Math.round(60*(t-a));$("#rest_value2").text(a+":"+("0"+t).slice(-2)),$("#rest_range").val(e),v.render_modal_check()},render_modal_check:function(){$("#time_edit_submit").addClass("disable"),$(".time-input, .rest-value, .shift-rest-value").removeClass("error"),$("#work_value, #shift_value").text("--"),$("#work_value2, #shift_value2").text("");var e=new Date(u.selectedDates).getHours(),t=60*e+new Date(u.selectedDates).getMinutes(),a=new Date(s.selectedDates).getHours(),n=60*a+new Date(s.selectedDates).getMinutes(),o=$("#picker_in_time").val(),r=$("#picker_out_time").val(),e=(0<over_day&&(e<=over_day&&(t+=1440,i=o.substr(0,2),l=o.substr(-2),o=(i=Number(i)+24)+":"+l),a<=over_day&&(n+=1440,i=r.substr(0,2),l=r.substr(-2),r=(i=Number(i)+24)+":"+l)),$("#rest_range").val());if(!t&&!n&&0<e)$(".rest-value").addClass("error");else if(t&&!n&&0<e)$(".rest-value").addClass("error");else if(!t&&n||!t&&0===n)$("#picker_in_time").addClass("error"),0<e&&$(".rest-value").addClass("error");else{if(t&&n){a=n-t;if(a-e<=0)return void $("#picker_out_time").addClass("error");if(a<=e)return void $(".rest-value").addClass("error");a-=e,$("#work_value").text(a+"分");var i=a/60,l=Math.floor(i),n=Math.round(60*(i-l));$("#work_value2").text(l+":"+("0"+n).slice(-2))}m.in_work_time!=o&&$("#time_edit_submit").removeClass("disable"),m.out_work_time!=r&&$("#time_edit_submit").removeClass("disable");(m.rest_hour2||0)!=e&&$("#time_edit_submit").removeClass("disable");t=$('select[name="place"] option:selected').attr("data-area-id"),a=(m.area_id!=t&&$("#time_edit_submit").removeClass("disable"),$("#memo").val());m.memo!=a&&$("#time_edit_submit").removeClass("disable")}},renderListData:function(){setTimeout(function(){$('.tabulator-calcs-top > [tabulator-field="shift_hour"]').text(_.shift_hour),$('.tabulator-calcs-top > [tabulator-field="work_hour"]').text(_.work_hour),$('.tabulator-calcs-top > [tabulator-field="work_minute"]').text(_.work_minute),$('.tabulator-calcs-top > [tabulator-field="rest_hour"]').text(_.rest_hour),$('.tabulator-calcs-top > [tabulator-field="rest_minute"]').text(_.rest_minute),$('.tabulator-calcs-top > [tabulator-field="over_hour"]').text(_.over_hour),$('.tabulator-calcs-top > [tabulator-field="over_minute"]').text(_.over_minute),$('.tabulator-calcs-top > [tabulator-field="night_hour"]').text(_.night_hour),$('.tabulator-calcs-top > [tabulator-field="night_minute"]').text(_.night_minute),$('.tabulator-calcs-top > [tabulator-field="late_hour"]').text(_.late_hour),$('.tabulator-calcs-top > [tabulator-field="late_minute"]').text(_.late_minute),$('.tabulator-calcs-top > [tabulator-field="left_hour"]').text(_.left_hour),$('.tabulator-calcs-top > [tabulator-field="left_minute"]').text(_.left_minute),$('.tabulator-calcs-top > [tabulator-field="normal_hour"]').text(_.normal_hour),$('.tabulator-calcs-top > [tabulator-field="normal_minute"]').text(_.normal_minute)},100)},show_toast:function(e){siiimpleToast.message(e,{position:"top|right"})},show_err_toast:function(e){siiimpleToast.alert(e,{position:"top|right"})}};$(function(){h(),$(document).on("click",".navbar-toggler",function(){var e;mobile_menu_visible=1===mobile_menu_visible?($("html").removeClass("nav-open"),$(".close-layer").remove(),setTimeout(function(){$(this).removeClass("toggled")},400),0):(setTimeout(function(){$(this).addClass("toggled")},430),e=$('<div class="close-layer"></div>'),0!=$("body").find(".main-panel").length?e.appendTo(".main-panel"):$("body").hasClass("off-canvas-sidebar")&&e.appendTo(".wrapper-full-page"),setTimeout(function(){e.addClass("visible")},100),e.click(function(){$("html").removeClass("nav-open"),mobile_menu_visible=0,e.removeClass("visible"),setTimeout(function(){e.remove(),$(this).removeClass("toggled")},400)}),$("html").addClass("nav-open"),1)}),Promise.all([v.renderTableColumns,v.renderDate]).then(function(){v.renderDateText(d),v.renderTableData(),v.renderUserData()}),$("#modal2").iziModal({headerColor:"#1591a2",focusInput:!1,width:700}),$(document).delegate("#less_month","click",function(){d=e(new Date(d),-1,"MM"),v.renderDateText(d),v.renderTableData()}),$(document).delegate("#add_month","click",function(){d=e(new Date(d),1,"MM"),v.renderDateText(d),v.renderTableData()}),$(document).delegate("#this_month_mark, #this_month","click",function(){(d=new Date).setDate(1),v.renderDateText(d),v.renderTableData()}),$(document).delegate("#rest_range","input",function(){var e=$(this).val();v.render_rest_btn(e)}),$(document).delegate(".r_btn","click",function(){var e=$(this).attr("data-time");v.render_rest_btn(e)}),$(document).delegate(".time-val","input change",function(){v.render_modal_check()}),$(document).delegate("#picker_del_in_time","click",function(){u.clear(),v.render_modal_check()}),$(document).delegate("#picker_del_out_time","click",function(){s.clear(),v.render_modal_check()}),$(document).delegate("#time_edit_submit","click",function(){$("#time_edit_submit").addClass("disable"),g().done(function(e){"ok"===e.message?($("#modal2").iziModal("close"),v.show_toast(e.today+" 修正登録 "+$("#user_name").text()+" "+e.user_id),v.renderTableData()):v.show_err_toast("通信エラー")}).fail(function(){v.show_err_toast("通信エラー")})}),$(document).on("click",".header-menu-btn",function(){$(this).next(".dropdown-menu").toggleClass("show")}),$(document).click(function(e){$(e.target).closest(".dropdown-menu").length||$(e.target).closest(".header-menu-btn").length||$(".dropdown-menu").removeClass("show")}),$(document).on("click",".dropdown-item",function(){Cookies.set("notice_id",$(this).attr("id")),location.href="/mypage_notice"}),$("#download_btn_excel").on("click",function(){p("xlsx")}),$("#download_btn_pdf").on("click",function(){p("pdf")})})}();
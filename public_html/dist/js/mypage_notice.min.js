!function(){var g,f,v,p,b,t=0,h=(Cookies.get("notice_id")&&(g=Cookies.get("notice_id")),[]),i=function(){var e={system_id:sysId,user_id:userId};socket.emit("notice_client_to_server",e),socket.on("notice_server_to_client",function(e){h=e,y.render_notice(h)})},s=function(e){e={system_id:sysId,notice_id:e,user_id:userId};socket2.emit("notice_text_client_to_server",e),socket2.on("notice_text_server_to_client",function(e){y.render_message(e)})},e=function(e){return $.ajax({type:"POST",url:"../../data/notice/submit_message",data:{notice_id:g,message:$('textarea[name="message_text"]').val(),user_id:userId,flag:e,notice_flag:f,notice_date:v,from_userId:b,notice_end_date:p}})},y={render_notice:function(e){$(".notice-menu-area").html(""),$.each(e,function(e,t){if(t.user_id!=userId&&t.high_user_id.indexOf(String(userId))<0)return!0;0==t.notice_status&&(a=t.user_id==userId?(i="承認依頼中",s='<i class="far fa-paper-plane"></i>',"alert-warning"):(i="申請",s='<i class="fas fa-bell"></i>',"alert-info")),1==t.notice_status&&(a=(s=(i=t.user_id==userId?t.from_user_name+"から<br>承認されました":t.from_user_name+"が<br>承認しました",'<i class="fas fa-thumbs-up"></i>'),"alert-success")),2==t.notice_status&&(a=(s=(i=t.user_id==userId?"申請NGです":"NG送信中",'<i class="fas fa-exclamation-circle"></i>'),"alert-danger")),1==t.notice_flag&&(n="修正依頼",o=t.before_in_time+"〜"+t.before_out_time+" を "+t.notice_in_time+"〜"+t.notice_out_time+" に時刻修正を申請",c=" type-color01"),2==t.notice_flag&&(n="削除依頼",o=t.before_in_time+"〜"+t.before_out_time+" を 削除申請",c=" type-color02"),3==t.notice_flag&&(n="遅刻依頼",o=t.notice_in_time+" 出勤に 遅刻申請",c=" type-color03"),4==t.notice_flag&&(n="早退依頼",o=t.notice_out_time+" 退勤に 早退申請",c=" type-color04"),5==t.notice_flag&&(n="残業依頼",o=t.notice_out_time+" まで 残業申請",c=" type-color05"),6==t.notice_flag&&(n="有給依頼",o="",c=" type-color06"),7==t.notice_flag&&(n="欠勤依頼",o="",c=" type-color07"),8==t.notice_flag&&(n="その他依頼",o="",c=" type-color08"),11==t.notice_flag&&(n="休暇依頼",o="",c=" type-color11"),l=t.user_id==userId?n+"を申請<br><br>":"ID:"+t.user_id+"<br>"+t.user_name+" から "+n+"<br><br>";var i,s,a,n,o,c,l,r=new Date(t.to_date),d=r.getFullYear(),_=r.getMonth()+1,u=r.getDate(),m=["日","月","火","水","木","金","土"][r.getDay()],f=d+"年"+("0"+_).slice(-2)+"月"+("0"+u).slice(-2)+"日("+m+")",_=(r=t.end_date?(d=(r=new Date(t.end_date)).getFullYear(),_=r.getMonth()+1,u=r.getDate(),m=["日","月","火","水","木","金","土"][r.getDay()]," から "+d+"年"+("0"+_).slice(-2)+"月"+("0"+u).slice(-2)+"日("+m+")"):"",d=g==t.notice_id?" notice-select":"",'<div id="'+t.notice_id+'" class="notice-menu alert '+a+d+'"><div class="title">'+s+'<div class="notice-title">'+i+'<span class="'+a+" notice-type"+c+'">'+n+'</span></div></div><div class="sub-title"><i class="far fa-clock"></i> '+t.notice_datetime.slice(0,-3)+'</div><div class="box-main">'+l+f+r+'  <i class="fas fa-angle-double-right"></i> '+n+" "+o+"</div></div>");$(".notice-menu-area").append(_)})},render_message:function(e){$("#message_area").html(""),0==e.notice_status&&(s=e.to_user_id==userId?(t="承認依頼中",i='<i class="far fa-paper-plane"></i>',"alert-warning"):(t="申請があります",i='<i class="fas fa-bell"></i>',"alert-info")),1==e.notice_status&&(s=(i=(t=e.to_user_id==userId?e.from_user_name+" から承認されました":e.from_user_name+" が承認しました",'<i class="fas fa-thumbs-up"></i>'),"alert-success")),2==e.notice_status&&(s=(i=(t=e.to_user_id==userId?"申請NGです":"NG送信中",'<i class="fas fa-exclamation-circle"></i>'),"alert-danger")),1==e.notice_flag&&(a="修正依頼",n=" type-color01",f=1,o=e.before_in_time+"〜"+e.before_out_time+" を "+e.notice_in_time+"〜"+e.notice_out_time+" に時刻修正を申請"),2==e.notice_flag&&(a="削除依頼",n=" type-color02",f=2,o=e.before_in_time+"〜"+e.before_out_time+" を 削除申請"),3==e.notice_flag&&(a="遅刻依頼",n=" type-color03",f=3,o=e.notice_in_time+" 出勤に 遅刻申請"),4==e.notice_flag&&(a="早退依頼",n=" type-color04",f=4,o=e.notice_out_time+" 退勤に 早退申請"),5==e.notice_flag&&(a="残業依頼",n=" type-color05",f=5,o=e.notice_out_time+" まで 残業申請"),6==e.notice_flag&&(a="有給依頼",n=" type-color06",f=6,o=""),7==e.notice_flag&&(a="欠勤依頼",n=" type-color07",f=7,o=""),8==e.notice_flag&&(a="その他依頼",n=" type-color08",f=8,o=""),11==e.notice_flag&&(a="休暇依頼",n=" type-color11",f=11,o="");var t,i,s,a,n,o,c,l=new Date(e.to_date),r=l.getFullYear(),d=l.getMonth()+1,_=l.getDate(),u=["日","月","火","水","木","金","土"][l.getDay()],m=r+"年"+("0"+d).slice(-2)+"月"+("0"+_).slice(-2)+"日("+u+")";v=r+"-"+d+"-"+_,e.end_date?(r=(l=new Date(e.end_date)).getFullYear(),d=l.getMonth()+1,_=l.getDate(),u=["日","月","火","水","木","金","土"][l.getDay()],c=" から "+r+"年"+("0"+d).slice(-2)+"月"+("0"+_).slice(-2)+"日("+u+")",p=r+"-"+d+"-"+_):c="",b=e.to_user_id;l=e.permit_high_user_auth.indexOf(String(userId))<0?"":'<div class="inner auth-btn"><div id="ok_submit" class="notice-header-btn">承認</div><div id="ng_submit" class="notice-header-btn">N G</div></div>';u='<div class="inner"><div class="notice-header-icon alert '+s+'">'+i+'</div><div class="notice-header-text-area"><div class="notice-header-title"><i class="fas fa-user"></i> '+(e.to_user_id==userId?"":"<b>"+e.user_name+"</b> より")+'<span class="title'+n+" "+s+'">'+a+'</span><span class="state">'+t+'</span></div><div class="notice-header-subtitle"><span class="date-title">希望日</span><span class="date">'+m+c+"</span>"+o+"</div></div></div>";$("#notice_title").html(u+l);$.each(e.massage,function(e,t){n=t.user_id==userId?(i=""," my"):(i=t.user_name+" より","");var i,s="",a=(1===Number(t.notice_status)&&(s=" permit"),2===Number(t.notice_status)&&(s=" ng"),t.message_text.replace(/\n/g,"<br>")),n='<div class="inner'+n+'"><div class="notice-icon"></div><div class="notice-message-box"><div class="notice-user-name">'+i+'<span class="notice-date">'+t.text_datetime.slice(0,-3)+'</span></div><div class="notice-message'+s+'">'+a+'</div></div><div class="message-img"></div></div>';$("#message_area").append(n)}),y.render_notice(h)},show_toast:function(e){siiimpleToast.message(e,{position:"top|right"})},show_err_toast:function(e){siiimpleToast.alert(e,{position:"top|right"})}};$(function(){i(),g&&s(g),$(document).on("click",".navbar-toggler",function(){var e;t=1===t?($("html").removeClass("nav-open"),$(".close-layer").remove(),setTimeout(function(){$(this).removeClass("toggled")},400),0):(setTimeout(function(){$(this).addClass("toggled")},430),e=$('<div class="close-layer"></div>'),0!=$("body").find(".main-panel").length?e.appendTo(".main-panel"):$("body").hasClass("off-canvas-sidebar")&&e.appendTo(".wrapper-full-page"),setTimeout(function(){e.addClass("visible")},100),e.click(function(){$("html").removeClass("nav-open"),t=0,e.removeClass("visible"),setTimeout(function(){e.remove(),$(this).removeClass("toggled")},400)}),$("html").addClass("nav-open"),1)}),$(document).on("click",".nav-link",function(){$(".tab-pane, .nav-link").removeClass("active"),$(this).addClass("active"),$("#"+$(this).attr("data-tab")).addClass("active")}),$(document).on("click",".notice-menu",function(){$(".notice-menu").removeClass("active"),$(this).addClass("active"),g=$(this).attr("id"),Cookies.set("notice_id",g),s(g)}),$(document).on("click","#basic_submit",function(){""!==$('textarea[name="message_text"]').val()&&($("#basic_submit").addClass("disabled"),e(0).done(function(e){s(g),$("#basic_submit").removeClass("disabled"),$('textarea[name="message_text"]').val("")}))}),$(document).on("click","#ok_submit",function(){$("#ok_submit").addClass("disabled"),e(1).done(function(e){$("#ok_submit").removeClass("disabled"),s(g),i(),y.render_notice(h)})}),$(document).on("click","#ng_submit",function(){$("#ng_submit").addClass("disabled"),e(2).done(function(e){$("#ng_submit").removeClass("disabled"),s(g),i(),y.render_notice(h)})})})}();
!function(){var n,o,s=0,a="",_="",r=function(){var e={system_id:sysId,user_id:userId};socket.emit("notice_client_to_server",e),socket.on("notice_server_to_client",function(e){var _=0,r=0;$.each(e,function(e,t){if(t.user_id!=userId&&t.high_user_id.indexOf(String(userId))<0)return!0;0==t.notice_status&&_++,1==t.notice_status&&(t.user_id,userId),2==t.notice_status&&(t.user_id,userId,r++),t.user_id!=userId&&(t.user_id,t.user_name);var i=new Date(t.to_date),a=i.getFullYear(),n=i.getMonth()+1,o=i.getDate(),s=["日","月","火","水","木","金","土"][i.getDay()];("0"+n).slice(-2),("0"+o).slice(-2);t.end_date&&(a=(i=new Date(t.end_date)).getFullYear(),n=i.getMonth()+1,o=i.getDate(),s=["日","月","火","水","木","金","土"][i.getDay()],("0"+n).slice(-2),("0"+o).slice(-2))}),$("#notice_count_new, .badge-text1").hide(),$("#notice_count_ng, .badge-text2").hide(),0<_&&($("#notice_count_new, .badge-text1").show(),$("#notice_count_new").text(_)),0<r&&($("#notice_count_ng, .badge-text2").show(),$("#notice_count_ng").text(r))})},l=function(e){return a=e,$.ajax({type:"POST",dataType:"json",url:"../../data/gateway/mail_time",data:{user_id:userId,date:e}})},c=function(e){return $.ajax({type:"POST",url:"../../data/gateway/notice",data:{to_user_id:userId,to_date:a,notice_flag:n,notice_in_time:e.notice_in_time,notice_out_time:e.notice_out_time,notice_text:$("#textarea1").val(),user_name:user_name,before_in_time:$('input[name="before_in_time"]').val(),before_out_time:$('input[name="before_out_time"]').val(),end_date:_}})},m={render_notice_title:function(e){switch(m.reset_view(),e){case 1:var t='時刻修正申請<span class="sub-text">出退勤時刻の修正依頼をします</span>';o.set("maxDate",new Date),$("#step03_title").text("申請する修正時刻を入力");break;case 2:t="時刻削除申請";o.set("maxDate",new Date);break;case 3:t="遅刻申請";o.set("minDate",new Date),$("#step03_title").text("申請する遅刻時刻を入力");break;case 4:t="早退申請";o.set("minDate",new Date),$("#step03_title").text("申請する早退時刻を入力");break;case 5:t="残業申請";o.set("minDate",new Date),$("#step03_title").text("申請する残業時刻を入力");break;case 6:t="有給申請";o.set("minDate",new Date),o.set("mode","range");break;case 7:t="欠勤申請";o.set("minDate",new Date);break;case 8:t="その他申請";break;case 9:t="有給申請（半日）";o.set("minDate",new Date);break;case 11:t="休暇申請";o.set("minDate",new Date)}$("#notice_notice_flag").html(t),$("#step02_area").show()},render_now_time:function(e){var t=e.in_work_time?e.in_work_time.substr(0,5):"未出勤",i=($(".now-in-time").text(t),$('input[name="before_in_time"]').val(t),e.out_work_time?e.out_work_time.substr(0,5):"未退勤");$(".now-out-time").text(i),$('input[name="before_out_time"]').val(i),1===n&&($("#now_in_time").val(t),$("#now_out_time").val(i),$("#step03_area").show(),$("#step04_area").show(),$("#step02_now_time").show(),$("#step02_now_time").css("display","flex")),2===n&&($(".del-in-time").text(t),$(".del-out-time").text(i),e.in_work_time||e.out_work_time?($("#step03_2_title").html('<b style="font-size:20px;color:#f00">下記時刻を削除申請</b>'),$("#step04_area").show()):$("#step03_2_title").html('<i class="fas fa-exclamation-triangle"></i> 削除する時刻がありません'),$("#step03_2_area").show(),$("#step02_now_time").show(),$("#step02_now_time").css("display","flex")),3===n&&($("#input_in_time_area, #input_out_time_area").show(),$("#input_out_time_area").hide(),$("#step03_area").show(),$("#step04_area").show()),4!==n&&5!==n||($("#input_in_time_area, #input_out_time_area").show(),$("#input_in_time_area").hide(),$("#step03_area").show(),$("#step04_area").show()),6!==n&&7!==n&&8!==n&&11!==n&&9!==n||$("#step04_area").show(),10<a.length&&(_=a.slice(-10),a=a.slice(0,10)),$("#step02_title").text(a+" から "+_),$("#step02_title").addClass("active"),$("#step02_return_area").show()},reset_view:function(){_=a="",$(".area-none").hide(),$("#step02_title").removeClass("active"),$("#step02_title").text("申請日を選択"),$("#datepicker1").removeClass("cale-on"),o.destroy(),o=flatpickr("#datepicker1",{inline:!0,locale:"ja",onChange:function(e,t,i){$("#datepicker1").addClass("cale-on"),l(t).done(function(e){m.render_now_time(e)})}}),$("#now_in_time, #now_out_time").val(""),$("#input_in_time_area, #input_out_time_area").show(),$("#step02_now_time").hide(),$("#step02_return_area").hide()},show_mail_error:function(){$(".mail-err").show(),setTimeout(function(){$(".mail-err").hide()},2e3)}};$(function(){r(),$(document).on("click",".navbar-toggler",function(){var e;s=1===s?($("html").removeClass("nav-open"),$(".close-layer").remove(),setTimeout(function(){$(this).removeClass("toggled")},400),0):(setTimeout(function(){$(this).addClass("toggled")},430),e=$('<div class="close-layer"></div>'),0!=$("body").find(".main-panel").length?e.appendTo(".main-panel"):$("body").hasClass("off-canvas-sidebar")&&e.appendTo(".wrapper-full-page"),setTimeout(function(){e.addClass("visible")},100),e.click(function(){$("html").removeClass("nav-open"),s=0,e.removeClass("visible"),setTimeout(function(){e.remove(),$(this).removeClass("toggled")},400)}),$("html").addClass("nav-open"),1)}),o=flatpickr("#datepicker1",{inline:!0,locale:"ja"});var e=$("#now_in_time").attr("data-edit-in-time").slice(0,2),t=$("#now_in_time").attr("data-edit-in-time").slice(3,2),i=$("#now_out_time").attr("data-edit-out-time").slice(0,2),a=$("#now_out_time").attr("data-edit-out-time").slice(3,2);$("#now_in_time").timepicki({show_meridian:!1,disable_keyboard_mobile:!0,min_hour_value:0,max_hour_value:23,reset:!0,increase_direction:"down",step_size_minutes:edit_min,start_time:[e,t]}),$("#now_out_time").timepicki({show_meridian:!1,disable_keyboard_mobile:!0,min_hour_value:0,max_hour_value:23,reset:!0,increase_direction:"down",step_size_minutes:edit_min,start_time:[i,a]}),$(document).delegate(".notice_flag","click",function(){n=Number($(this).attr("id").slice(-2)),$(".notice_flag").removeClass("disabled"),$(this).addClass("disabled"),m.render_notice_title(n)}),$(document).delegate("#step02_return","click",function(){m.reset_view(),m.render_notice_title(n)}),$("#textarea1").keyup(function(){$("#textarea1").val()?$("#mail_submit").removeClass("disabled"):$("#mail_submit").addClass("disabled")}),$("#mail_submit").on("click touchstart",function(e){function t(e){return null!=e&&5==e.length}var i;if(e.preventDefault(),$(this).addClass("disabled"),e=t($("#now_in_time").val())?$("#now_in_time").val()+":00":"",i=t($("#now_out_time").val())?$("#now_out_time").val()+":00":"",1===n){if(""===e)return void m.show_mail_error();if(""!==i&&i<=e)return void m.show_mail_error()}c({notice_in_time:e,notice_out_time:i}).done(function(e){"ok"==e&&(r(),siiimpleToast.message("申請完了しました",{position:"top|right"}),setTimeout(function(){location.href="/mypage_dashboard"},3e3))}).fail(function(e){siiimpleToast.alert("エラー",{position:"top|right"}),setTimeout("location.reload()",3e3)})}),$(document).on("click",".header-menu-btn",function(){$(this).next(".dropdown-menu").toggleClass("show")}),$(document).click(function(e){$(e.target).closest(".dropdown-menu").length||$(e.target).closest(".header-menu-btn").length||$(".dropdown-menu").removeClass("show")}),$(document).on("click",".dropdown-item",function(){Cookies.set("notice_id",$(this).attr("id")),location.href="/mypage_notice"})})}();